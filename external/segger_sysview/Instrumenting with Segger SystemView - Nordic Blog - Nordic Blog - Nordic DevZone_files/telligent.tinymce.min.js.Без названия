(function(){tinymce.PluginManager.add("bottomtoolbar",function(c,t){var q=[];$.each(c.settings.menu,function(s,g){var a=[];$.each((g.items||"").split(/[ ,]/),function(k,f){("|"==f||c.menuItems[f])&&a.push("|"==f?{text:"|"}:c.menuItems[f])});0<a.length&&(c.addButton("menu_"+s,{type:"menubutton",text:g.title||"",menu:a}),q.push("menu_"+s))});q=q.join(" ");0>c.settings.toolbar.indexOf(q)&&(c.settings.toolbar=q+" "+(c.settings.toolbar||""));c.on("Init",function(){var s=c.getContainer(),g=$(".mce-edit-area",
s).css("border-width","0 0 1px 0");$(".mce-menubar",s).hide();$(".mce-toolbar-grp",s).insertAfter(g)})});tinymce.PluginManager.add("embeddables",function(c,t){var q=tinymce.html.Node,s=tinymce.util.JSON,g=this,a=null,k=0;g.editor=c;g.url=t;g.isEmbeddableSpan=function(b){return b&&"SPAN"===b.nodeName&&this.editor.dom.hasClass(b,"mceInsertEmbeddableItem")};g.openDialog=function(b,m){function f(){var d=$(A.getEl());$(".mceembeddableConfigureEmbeddable",d).prepend(r)}function c(){window.clearTimeout(w);
try{var d=$(".mcetelligent-frame",$(A.getEl()));if(0==d.length)return;var b=d.get(0).contentWindow;if(b&&b.document&&0<(b.location+"").indexOf("embeddables/configure")){F&&(F=!1,r.hide(),d.css("visibility","visible"));var h=$("html",b.document).outerHeight(!0);$("*",b.document.body).each(function(){var d=$(this),b=d.css("position");if("absolute"==b||"fixed"==b){var a=d.offsetParent(),f=a.css("overflow-y");0<a.length&&("hidden"==f||"scroll"==f)&&(b="");if("absolute"==b||"fixed"==b)b=d.offset(),b.top+
d.outerHeight()>h&&(h=b.top+d.outerHeight(!0))}});var h=h+12,a=parseInt(d.css("height"),10);if(a!=h&&Math.abs(a-h)>v&&100<h){d.css("height",h+"px");for(var f=$(d.get(0).parentNode),m=A.getEl();0<f.length&&f.get(0)!=m;)f.hasClass("mce-abs-layout")||"absolute"==f.css("position")?f.css("height",h+"px"):f.css("height","auto"),f=f.parent();A.reflow()}}}catch(p){}w=window.setTimeout(function(){c()},250)}function h(d){return p.typeid!=d?"":p.configuration}function d(d,b,h){d={typeid:d,id:b,configuration:h,
elementId:"mceInsertEmbeddable"+k++};g.editor.execCommand("mceRepaint");d=g.dataToSpan(d);g.editor.selection.setNode(d);g.editor.nodeChanged();A.close()}var p={typeid:m},u,g=this,A,y="Insert {0}",w=null;if(null!=a&&0!=a.length){u=b?b:g.editor.selection.getNode();g.isEmbeddableSpan(u)&&(p=g.editor.dom.getAttrib(u,"data-mce-json"))&&(p=s.parse(p),y="Edit {0}");y=tinymce.util.I18n.translate(y);for(u=0;u<a.length;u++)if(a[u].typeid==p.typeid){y=y.replace(/\{0\}/,a[u].name);break}u=$("<div></div>").css({width:"100px",
height:"10px",overflow:"scroll"}).appendTo($("body"));var z=$("<div></div>").css({width:"100%",height:"20px"}).appendTo(u).outerWidth();u.remove();var v=100-z;g.editor.getParam("evolution_contenttypeid");$.telligent.evolution.url.encode(window.location);var r=$('<div class="ui-loading" style="color: #ddd; font-size: 50px; box-sizing: border-box; position: relative; top: 30px;"></div>'),F=!0;window.Embeddable={setConfiguration:d,getConfiguration:h,ready:function(){c()},unready:function(){window.clearTimeout(w)}};
A=g.editor.windowManager.open({layout:"flow",title:tinymce.util.I18n.translate(y),body:[{type:"container",html:'<div class="mceembeddableConfigureEmbeddable" style="width:680px; height: 100px;">'+g.getConfigurationHtml(p.typeid,p,"visibility:hidden;")+"</div>"}],buttons:[{text:"Ok",onclick:function(){var d=$(A.getEl());$(".mcetelligent-frame",d).get(0).contentWindow.embedFormSubmit()},subtype:"primary"},{text:"Cancel",onclick:function(){A.close()}}],width:680});f()}};g.loadConfiguration=function(b,
a,f){a.html(g.getConfigurationHtml(b,f))};g.getConfigurationHtml=function(b,a,f){b=g.url+"../../../apis/embeddables/configure?typeId="+b;null!=a&&(b+="&id="+a.id);return'<iframe class="mcetelligent-frame" style="width: 100%; height: 200px; overflow: hidden;'+(f||"")+'" src="'+b+'" scrolling="no"></iframe>'};g.resolveWhitespace=function(b){if(!b)return b;" "==b.substr(0,1)&&(b="&nbsp;"+b.substr(1));" "==b.substr(b.length-1)&&(b=b.substr(0,b.length-1)+"&nbsp;");return b};g.textToSpan=function(b){var a=
this,f=a.editor;if(b.parent){for(var c=new q("div"),h=/\[embed:([^\]]*)\]/gi,d,p=0;d=h.exec(b.value);)(function(){for(var h=RegExp.$1.split(/:/g),u=h[0],w=h[1],z="",v=2;v<h.length;v++)z+=h[v];var r={id:w,typeid:u,configuration:z,elementId:"mceInsertEmbeddable"+k++};if(0<d.index)for(h=f.parser.parse(a.resolveWhitespace(b.value.substr(p,d.index-p))).getAll("p"),u=0;u<h.length;u++)for(;null!=(w=h[u].walk());)c.append(w);h=new q("span",1);h.attr({id:r.elementId,"class":"mceItem mceInsertEmbeddableItem mceNonEditable",
"data-mce-json":s.serialize(r,"'"),contenteditable:"false"});c.append(h);a.getPreview(r,function(d,b,h,a){if(h=f.dom.get(r.elementId))a&&$(h).append($('<span class="preview">'+a+"</span>")),b=$('<span class="type-info">'+b+"</span>"),d&&b.prepend('<img src="'+d+'" />'),$(h).append(b)})})(),p=h.lastIndex;if(0<p){if(p<b.value.length)for(var h=f.parser.parse(a.resolveWhitespace(b.value.substr(p))).getAll("p"),u=0;u<h.length;u++)for(var g;null!=(g=h[u].walk());)c.append(g);b.replace(c);c.unwrap()}}};
g.spanToObject=function(b,a){var f;if(f=b.attr("data-mce-json")){f=s.parse(f);var c=g.generateEmbedCode(f);f=new q("#text",3);f.raw=!0;f.value=c;b.replace(f)}};g.dataToSpan=function(b){var a=this.editor,f=this.editor.dom.create("span",{id:b.elementId,"class":"mceItem mceInsertEmbeddableItem mceNonEditable","data-mce-json":s.serialize(b,"'"),contenteditable:"false"});this.getPreview(b,function(f,h,d,c){if(d=a.dom.get(b.elementId))c&&$(d).append($('<span class="preview">'+c+"</span>")),h=$('<span class="type-info">'+
h+"</span>"),f&&h.prepend('<img src="'+f+'" />'),$(d).append(h)});return f};g.getCallbackUrl=function(b){for(var a=this.url+"../../../apis/embeddables?",f={},c=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),h=0;h<c.length;h++){var d=c[h].split(/=/);2==d.length&&(f[d[0]]=d[1])}for(var p in b)f[encodeURIComponent(p)]=encodeURIComponent(b[p]);b=!0;for(p in f)b?b=!1:a+="&",a+=p+"="+f[p];return a};g.getPreview=function(b,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"preview"}),
data:"token="+encodeURIComponent(this.generateEmbedCode(b)),content_type:"application/x-www-form-urlencoded",success:function(b){b=tinymce.util.JSON.parse(b);try{b&&b.name?a(b.imageUrl,b.name,b.description,b.previewHtml):a("","","","")}catch(f){}},error:function(b){try{a("","","","")}catch(f){}}})};g.generateEmbedCode=function(b){return"[embed:"+b.typeid+":"+b.id+":"+b.configuration+"]"};g.editor.on("PreInit",function(){g.editor.parser.addNodeFilter("#text",function(b){for(var a=b.length;a--;)g.textToSpan(b[a])});
g.editor.serializer.addNodeFilter("span",function(b,a,f){a=b.length;for(var c;a--;)c=b[a],-1!==(c.attr("class")||"").indexOf("mceInsertEmbeddableItem")&&g.spanToObject(c,f)})});g.editor.on("init",function(){g.editor.on("dblclick",function(b){b=b.target;if(!g.isEmbeddableSpan(b)&&(b=b.parentNode,!b||!g.isEmbeddableSpan(b)))return;var f=g.editor.dom.getAttrib(b,"data-mce-json");if(f)for(var f=s.parse(f),c=0;c<a.length;c++)a[c].typeid==f.typeid&&a[c].configurable&&g.openDialog(b)})});a=c.settings.evolution_embeddables;
c.on("ResolveName",function(b){"span"===b.name&&g.isEmbeddableSpan(b.target)&&(b.name=tinymce.util.I18n.translate("embeddable"))});for(var f=0;f<a.length;f++)(function(b){c.addMenuItem("embed"+b.typeid,{text:tinymce.util.I18n.translate("Insert {0}").replace(/\{0\}/,b.name),context:"insert",image:0<b.previewUrl.length?b.previewUrl:null,prependToContext:!0,onClick:function(a){b.configurable?g.openDialog(null,b.typeid):(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var a=16*Math.random()|
0;return("x"==b?a:a&3|8).toString(16)}),a={typeid:b.typeid,id:a,configuration:"",elementId:"mceInsertEmbeddable"+k++},g.editor.execCommand("mceRepaint"),a=g.dataToSpan(a),g.editor.selection.setNode(a),g.editor.nodeChanged())}})})(a[f]);c.addMenuItem("editembeddable",{text:"Edit embeddable",onclick:function(b){g.openDialog(c.selection.getNode())},context:"edit",prependToContext:!0,onPostRender:function(b){b.control.hide();c.on("NodeChange",function(){var f=c.selection.getNode();b.control.hide();if("SPAN"==
f.nodeName&&g.isEmbeddableSpan(f)&&(data=g.editor.dom.getAttrib(f,"data-mce-json")))for(data=s.parse(data),f=0;f<a.length;f++)if(a[f].typeid==data.typeid&&a[f].configurable){var k=b.control.getEl();$(".mce-text",k).text(tinymce.util.I18n.translate("Edit {0}").replace(/\{0\}/,a[f].name));0<a[f].previewUrl.length?$(".mce-ico",k).css("background-image","url('"+a[f].previewUrl+"')"):$(".mce-ico",k).css("background-image","none");b.control.show();break}},!0)}});c.addButton("editembeddable",{text:"Edit",
onclick:function(){g.openDialog(c.selection.getNode())}});c.addButton("removeembeddable",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(b){return g.isEmbeddableSpan(b)},"editembeddable removeembeddable")});tinymce.PluginManager.add("emoticons",function(c,t){var q=tinymce.html.Node,s=tinymce.util.JSON,g=1,a=this,k={},f=!1,b=!1,m=/[ \s\t]+/,n=/[ \s\t]/,l,h,d={container:null,selected:null,selectedIndex:-1,current:null},p=null,u=null,x=-1,A=0;a.editor=
c;a.url=t;a.openDialog=function(){function d(){$.fn.evolutionTip.hide();p.empty();k.show();a.loadEmoticons(m.val(),function(d,a){d==m.val()&&(a&&(n=null,$.each(a,function(d,a){p.append($('<div class="mceemoticon-emoticon" data-id="'+a.id+'">'+a.previewHtml+"</div>").on("click",function(){f(a.id,a.previewHtml)}).on("mouseover",function(){$(this).addClass("mceEmoticonsSelected");var d=this;n!=a.id&&(window.clearTimeout(B),h(),B=window.setTimeout(function(){b(d,a)},333),n=a.id)}).on("mouseout",function(){$(this).removeClass("mceEmoticonsSelected")}))})),
k.hide())})}function b(d,l){var m=l.variations;0==m.length&&h();if(!u){u=document.createElement("div");c.dom.setAttrib(u,"class","mceEmoticonsList mceEmoticonVariationsList");c.dom.setAttrib(u,"style","position:absolute; z-index: 200001;");var p=document.createElement("ul");u.appendChild(p);document.body.appendChild(u)}u.childNodes[0].innerHTML="";u.style.display="block";var p=a.getWindowScrollOffset(window),w=a.getWindowScrollOffset(c.getWin()),k=null,k=c.dom.getPos(d),k={left:k.x,top:k.y,width:d.offsetWidth,
height:d.offsetHeight},B=k.left+k.width;u.style.top=k.top-w.y+p.y+"px";u.style.left=B+"px";$.each(m,function(d,b){var a=document.createElement("li");a.style.cursor="pointer";$(a).append('<span class="mceEmoticonsPreview">'+b.previewHtml+'</span><span class="mceEmoticonsLabel">'+b.name+"</span>");a.onclick=function(){f(b.id,b.previewHtml)};a.onmouseover=function(){a.className="mceEmoticonsSelected"};a.onmouseout=function(){a.className=""};u.childNodes[0].appendChild(a)})}function h(){u&&(u.style.display=
"none");n=null}function f(d,b){var c={id:"mceEmoticon"+g,emoticonId:d};g++;window.clearTimeout(B);h();a.editor.execCommand("mceRepaint");a.editor.selection.setContent('<span contenteditable="false" class="mceItem mceEmoticon mceNonEditable" id="'+c.id+'" data-mce-json="'+s.serialize(c,"'")+'">'+b+"</span>");a.editor.nodeChanged();$.fn.evolutionTip.hide();l.close()}var l,m,p,k,u=null,B=null,n=null;l=a.editor.windowManager.open({title:tinymce.util.I18n.translate("Insert emoticon"),body:[{type:"container",
html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td>\t\t\t<select id="mceemoticon-collection" name="mceemoticon-collection" class="mce-textbox mcemedia-type" style="width: 390px;">\t\t\t</select>\t\t</td>\t</tr>\t</table></td></tr></table><div class="mceemoticon-listwrapper"><div class="mceemoticon-loading">'+tinymce.util.I18n.translate("Loading...")+'</div><div class="mceemoticon-list"></div></div>'}],
buttons:[{text:"Cancel",onclick:function(){l.close()}}],width:410,height:390});(function(){var b=$(l.getEl());b.on("click",function(){h()});m=$("#mceemoticon-collection",b).glowDropDownList({selectedItemWidth:390,selectedItemHeight:28,itemsWidth:390,itemsHeight:250,itemsHtml:[],showHtmlWhenSelected:!0,className:"mceemoticon-collection"}).on("change",function(){d()});p=$(".mceemoticon-list",b);k=$(".mceemoticon-loading",b).hide();a.loadEmoticonCollections(function(b){b&&(m.empty(),$.each(b,function(d,
b){m.glowDropDownList("add",m.glowDropDownList("createItem",{value:b.id,text:b.name,html:'<div class="mceemoticon-collectionitem"><div class="mceemoticon-collectionpreview">'+b.previewHtml+'</div><div class="mceemoticon-collectionlabel">'+b.name+"</div>"}))}),m.glowDropDownList("refresh"),d())})})();l.on("close",function(){h()})};a.handleKeyDown=function(d,h){if(f){if(40==h.keyCode)return 1==A?this.highlightNextVariation():this.highlightNextEmoticon(),this.cancelEvent(h);if(38==h.keyCode)return 1==
A?this.highlightPreviousVariation():this.highlightPreviousEmoticon(),this.cancelEvent(h);if(13==h.keyCode)return this.selectEmoticon(d,this.getCurrentWord(d)),b=!1,this.cancelEvent(h);if(27==h.keyCode)return b=!1,this.hideEmoticons(),this.cancelEvent(h);if(37==h.keyCode&&1==A)return a.setVariationMode(0),this.cancelEvent(h);if(39==h.keyCode&&0==A)return a.setVariationMode(1),this.cancelEvent(h)}};a.cancelEvent=function(d){d.preventDefault();d.stopImmediatePropagation();d.stopPropagation();return!1};
a.getLastTypedCharacter=function(d,b){var a=d.getDoc(),h=d.selection.getSel();if(h.focusNode&&h.focusOffset){if(a=h.focusNode.nodeValue,0<=h.focusOffset-1&&a&&a.length>=h.focusOffset)return a.charAt(h.focusOffset-1)}else if(a.selection&&a.selection.createRange){h=a.selection.createRange();if(!(h.parentElement&&h.moveToPoint&&h.moveStart&&h.getBoundingClientRect))return"";if(null!=h.parentElement())try{h.parentElement().focus()}catch(f){}h=a.selection.createRange();a=h.getBoundingClientRect();0==a.left&&
0==a.top&&(h.moveToElementText(h.parentElement()),a=h.getBoundingClientRect(),a.left=a.right);a.left+=0==h.boundingLeft?a.right-a.left:0;a.top=(a.bottom+a.top)/2;h.moveToPoint(a.left,a.top);h.moveStart("character",-1);return h.text}return""};a.handleKeyUp=function(d,a){var c=this.getLastTypedCharacter(d,a);(f||b||":"==c)&&(40!=a.keyCode&&38!=a.keyCode&&13!=a.keyCode&&27!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)&&(c=this.getCurrentWord(d),b||(l=!0,h=""),100<c.length||""==c||m.test(c.substr(1))?(b=
!1,this.hideEmoticons()):(b=!0,0<c.length&&(l||c.length-1<=h.length||c.substr(1,h.length)!=h)?(f=!0,this.showEmoticons(d,c)):this.hideEmoticons()))};a.setVariationMode=function(d){0==d&&0!=A?(u&&(u.className="",x=-1,u=null),A=0):1==d&&1!=A&&(A=1,a.setHighlightedVariation(0))};a.highlightNextVariation=function(){p&&(u&&p.childNodes[0].childNodes.length>x+1)&&(u.className="",x++,u=p.childNodes[0].childNodes[x],u.className="mceEmoticonsSelected")};a.highlightPreviousVariation=function(){p&&(u&&0<p.childNodes[0].childNodes.length&&
0<x)&&(u.className="",x--,u=p.childNodes[0].childNodes[x],u.className="mceEmoticonsSelected")};a.setHighlightedVariation=function(d){p&&(p.childNodes[0].childNodes.length>d&&0<=d)&&(u&&(u.className=""),x=d,u=p.childNodes[0].childNodes[x],u.className="mceEmoticonsSelected",a.setVariationMode(1))};a.showVariations=function(){null!=d.current&&d.current[d.selectedIndex]&&d.current[d.selectedIndex].variations&&0!=d.current[d.selectedIndex].variations.length||a.hideVariations();var b=d.current[d.selectedIndex].variations;
if(!p){p=document.createElement("div");c.dom.setAttrib(p,"class","mceEmoticonsList mceEmoticonVariationsList");c.dom.setAttrib(p,"style","position:absolute; z-index: 200001;");var h=document.createElement("ul");p.appendChild(h);document.body.appendChild(p)}u=null;p.childNodes[0].innerHTML="";p.style.display="block";var h=this.getWindowScrollOffset(window),f=this.getWindowScrollOffset(c.getWin()),l=null,l=d.container.childNodes[0].childNodes[d.selectedIndex],m=c.dom.getPos(l),l={left:m.x,top:m.y,width:l.offsetWidth,
height:l.offsetHeight},m=l.top+h.y-2*f.y,k=l.left+l.width;l.top+h.y>$(window).height()/2?(p.style.bottom=$("body").outerHeight()-(m+f.y)-l.height+"px",p.style.left=k+"px",p.style.top="auto"):(p.style.top=m+f.y+"px",p.style.left=k+"px",p.style.bottom="auto");u=null;p.childNodes[0].innerHTML="";for(var n=c.selection.getBookmark(2),f=0;f<b.length;f++)h=document.createElement("li"),h.style.cursor="pointer",$(h).html('<span class="mceEmoticonsPreview">'+b[f].previewHtml+'</span><span class="mceEmoticonsLabel">'+
b[f].name+"</span>"),h.onclick=function(){c.selection.moveToBookmark(n);a.selectEmoticon(c,a.getCurrentWord(c))},h.onmouseover=function(){a.setHighlightedVariation(parseInt(c.dom.getAttrib(this,"data-index")))},c.dom.setAttrib(h,"data-index",f),c.dom.setAttrib(h,"data-id",b[f].id),c.dom.setAttrib(h,"data-preview",b[f].previewHtml),p.childNodes[0].appendChild(h)};a.highlightNextEmoticon=function(){d.container&&(d.selected&&d.container.childNodes[0].childNodes.length>d.selectedIndex+1)&&(d.selected.className=
"",d.selectedIndex++,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.showVariations())};a.highlightPreviousEmoticon=function(){d.container&&(d.selected&&0<d.container.childNodes[0].childNodes.length&&0<d.selectedIndex)&&(d.selected.className="",d.selectedIndex--,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.showVariations())};a.setHighlightedEmoticon=function(h){d.container&&
(d.selected&&d.container.childNodes[0].childNodes.length>h&&0<=h)&&(d.selected.className="",d.selectedIndex=h,d.selected=d.container.childNodes[0].childNodes[d.selectedIndex],d.selected.className="mceEmoticonsSelected",a.setVariationMode(0),a.showVariations())};a.showEmoticons=function(a,b){var f=this;if(!d.container){d.container=document.createElement("div");a.dom.setAttrib(d.container,"class","mceEmoticonsList");a.dom.setAttrib(d.container,"style","position:absolute; z-index: 200001;");var c=document.createElement("ul");
d.container.appendChild(c);document.body.appendChild(d.container)}d.selected=null;d.container.childNodes[0].innerHTML="";var m=document.createElement("li");m.innerHTML=tinymce.util.I18n.translate("Loading...");d.container.childNodes[0].appendChild(m);d.container.style.display="block";var c=this.getWindowScrollOffset(window),p=a.dom.getPos(a.getContentAreaContainer()),k=this.getWindowScrollOffset(a.getWin()),u=a.dom.getPos(a.selection.getNode()),n=0,B=0,B=a.selection.getRng();B.expand&&B.expand("word");
var g=null;0==B.getClientRects().length?B.parentElement&&B.getBoundingClientRect&&B.moveToPoint&&B.moveStart?(B.moveToElementText(B.parentElement()),g=B.getBoundingClientRect(),g.left=g.right,g.left+=0==B.boundingLeft?g.right-g.left:0,B.moveToPoint(g.left,g.top),B.moveStart("character",-1),g=B.getClientRects()[0]):B.insertNode&&(n=a.getWin().document.createElement("span"),B.insertNode(n),g=a.dom.getPos(n),g={left:g.x,top:g.y,width:0,height:n.offsetHeight},n.parentNode.removeChild(n)):g=B.getClientRects()[0];
g&&(!g.width&&!g.height&&g.right&&g.bottom)&&(g={width:g.right-g.left,height:g.bottom-g.top,left:g.left-p.x,top:g.top-p.y});g?(n=g.top+g.height,B=g.left):(n=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),"font-size",!0))+u.y,B=u.x);n+p.y>$(window).height()/2?(d.container.style.bottom=$("body").outerHeight()-(p.y+c.y+n-k.y)+g.height+"px",d.container.style.left=p.x+c.x+B-k.x+"px",d.container.style.top="auto"):(d.container.style.top=p.y+c.y+n-k.y+"px",d.container.style.left=p.x+c.x+B-k.x+"px",d.container.style.bottom=
"auto");d.lastSearchText=b;window.clearTimeout(d.searchHandle);var s=a.selection.getBookmark(2);d.searchHandle=window.setTimeout(function(){f.searchForEmoticons(b,function(b,c){if(d.lastSearchText==b)if(f.hideVariations(),d.selected=null,d.container.childNodes[0].innerHTML="",d.current=c||[],c&&0!=c.length){l=!0;h=b;for(var p=0;p<c.length;p++)m=document.createElement("li"),m.style.cursor="pointer",$(m).html('<span class="mceEmoticonsPreview">'+c[p].previewHtml+'</span><span class="mceEmoticonsLabel">'+
c[p].name+"</span>"),m.onclick=function(){a.selection.moveToBookmark(s);f.selectEmoticon(a,f.getCurrentWord(a))},m.onmouseover=function(){f.setHighlightedEmoticon(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(m,"data-index",p),a.dom.setAttrib(m,"data-id",c[p].id),a.dom.setAttrib(m,"data-preview",c[p].previewHtml),d.container.childNodes[0].appendChild(m),d.selected||(d.selectedIndex=p,d.selected=m,d.selected.className="mceEmoticonsSelected");f.showVariations()}else l&&(h=b.substr(0,
b.length-1),l=!1),f.hideEmoticons()})},249)};a.hideEmoticons=function(b){d.container&&(d.container.style.display="none",d.selected=null,d.selectedIndex=-1);a.hideVariations();f=!1};a.hideVariations=function(d){p&&(p.style.display="none",u=null,x=-1);A=0};a.getCurrentWord=function(d){var a=d.getDoc();d=d.selection.getSel();if(d.focusNode&&d.focusOffset){var a=d.focusNode.nodeValue,b=d.focusOffset-1;if(null==a||0==a.length)return"";d=0;for(var h=b;0<=h;h--)if(":"==a.charAt(h)){d=h;break}h=a.substr(d,
b+1-d);if(0<h.length&&":"==h.charAt(0).toString()&&(0==d||n.test(a.substr(d-1,1))))return h}else if(a.selection&&a.selection.createRange){d=a.selection.createRange();if(!(d.parentElement&&d.moveToPoint&&d.moveStart&&d.getBoundingClientRect))return"";if(null!=d.parentElement())try{d.parentElement().focus()}catch(f){}d=a.selection.createRange();a=d.getBoundingClientRect();0==a.left&&0==a.top&&(d.moveToElementText(d.parentElement()),a=d.getBoundingClientRect(),a.left=a.right);a.left+=0==d.boundingLeft?
a.right-a.left:0;a.top=(a.bottom+a.top)/2;d.moveToPoint(a.left,a.top);d.moveStart("word",-1);d.moveStart("character",-1);a=d.text;d=0;for(h=a.length-1;0<=h;h--)if(":"==a.charAt(h)){d=h;break}h=a.substr(d,a.length-d);if(0<h.length&&":"==h.charAt(0).toString()&&(0==d||n.test(a.substr(d-1,1))))return h}return""};a.selectEmoticon=function(a,h){var b;b=1==A?u:d.selected;if(!(0>=h.length)&&b){var f=a.selection.getRng();if(f.setStart)f.setStart(f.startContainer,f.startOffset-h.length);else if(f.parentElement&&
f.getBoundingClientRect&&f.moveToPoint&&f.moveStart){var c=f.getBoundingClientRect();0==c.left&&0==c.top&&(f.moveToElementText(f.parentElement()),c=f.getBoundingClientRect(),c.left=c.right,c.left+=0==f.boundingLeft?c.right-c.left:0,f.moveToPoint(c.left,c.top));f.moveStart("character",-1*h.length)}c={id:"mceEmoticon"+g,emoticonId:a.dom.getAttrib(b,"data-id")};g++;a.selection.setRng(f);a.selection.setContent('<span contenteditable="false" class="mceItem mceEmoticon mceNonEditable" id="'+c.id+'" data-mce-json="'+
s.serialize(c,"'")+'">'+a.dom.getAttrib(b,"data-preview")+"</span>");a.nodeChanged();this.hideEmoticons()}};a.getWindowScrollOffset=function(d){var a=0,h=0;"number"==typeof d.pageXOffset?(a=d.pageXOffset,h=d.pageYOffset):d.document.body&&(d.document.body.scrollLeft||d.document.body.scrollTop)?(a=d.document.body.scrollLeft,h=d.document.body.scrollTop):d.document.documentElement&&(d.document.documentElement.scrollLeft||d.document.documentElement.scrollTop)&&(a=document.documentElement.scrollLeft,h=
document.documentElement.scrollTop);return{x:a,y:h}};a.getCodePoint=function(d,a){if(null===d)throw TypeError();var h=String(d),b=h.length,f=a?Number(a):0;f!=f&&(f=0);if(!(0>f||f>=b)){var c=h.charCodeAt(f);return 55296<=c&&(56319>=c&&b>f+1)&&(h=h.charCodeAt(f+1),56320<=h&&57343>=h)?{code:1024*(c-55296)+h-56320+65536,isSurrogate:!0}:{code:c,isSurrogate:!1}}};a.spanToObject=function(d,a){var h,b;if(h=d.attr("data-mce-json"))h=s.parse(h),h.emoticonId&&(b=new q("#text",3),b.raw=!0,b.value="[emoticon:"+
h.emoticonId+"]");b?d.replace(b):d.remove()};a.resolveWhitespace=function(d){if(!d)return d;" "==d.substr(0,1)&&(d="&nbsp;"+d.substr(1));" "==d.substr(d.length-1)&&(d=d.substr(0,d.length-1)+"&nbsp;");return d};a.isStart=function(d){return k.unicode&&void 0!==k.unicode[d.toString(16)]};a.requiresMore=function(d){for(var a=k.unicode[d[0].toString(16)],h,b=1;b<d.length;b++){if(void 0===a)return!1;h=a[d[b].toString(16)];if(void 0!==h)a=h;else if(8205!=d[b])return!1}return void 0!==a&&void 0===a.id};a.couldHaveMore=
function(d){for(var a=k.unicode[d[0].toString(16)],h,b=1;b<d.length;b++){if(void 0===a)return!1;h=a[d[b].toString(16)];if(void 0!==h)a=h;else if(8205!=d[b])return!1}return void 0===a?!1:void 0!==a.id?1<Object.keys(a).length:0<Object.keys(a).length};a.isValidCombination=function(d){for(var a=k.unicode[d[0].toString(16)],h,b=1;b<d.length;b++){if(void 0===a)return!1;h=a[d[b].toString(16)];if(void 0!==h)a=h;else if(8205!=d[b])return!1}return void 0!==a&&void 0!==a.id};a.getId=function(d){for(var a=k.unicode[d[0].toString(16)],
h,b=1;b<d.length;b++){if(void 0===a)return null;h=a[d[b].toString(16)];if(void 0!==h)a=h;else if(8205!=d[b])return null}return void 0===a||void 0===a.id?null:a.id};a.parseEmojiInLine=function(){function d(a,h){0>h&&(h=0);if(3==a.nodeType){var b=a.data.length;h>b&&(h=b)}return h}function h(a,b){1!=a.nodeType||a.hasChildNodes()?f.setStart(a,d(a,b)):f.setStartBefore(a)}function b(a,h){1!=a.nodeType||a.hasChildNodes()?f.setEnd(a,d(a,h)):f.setEndAfter(a)}for(var f,c,l,m,p,k,B,u=!0,n=!1,x;u;)(function(){u=
!1;f=a.editor.selection.getRng(!0).cloneRange();if(1>f.startOffset){k=f.endContainer.previousSibling;if(!k){if(!f.endContainer.firstChild||!f.endContainer.firstChild.nextSibling)return;k=f.endContainer.firstChild.nextSibling}B=k.length;h(k,B);b(k,B);if(1>f.endOffset)return;c=f.endOffset;l=k}else{l=f.endContainer;if(3!=l.nodeType&&l.firstChild){for(;3!=l.nodeType&&l.firstChild;)l=l.firstChild;3==l.nodeType&&(h(l,0),b(l,l.nodeValue.length))}c=1==f.endOffset?2:f.endOffset}h(l,Math.max(0,c-200));b(l,
c);p=f.toString();for(var d=0;d<p.length&&!u;d++){var w=a.getCodePoint(p,d),A=!0,y;if(a.isStart(w.code)){x=w.isSurrogate?2:1;g++;var q=[];q.push(w.code);if(a.requiresMore(q))for(;A&&a.requiresMore(q);)(y=a.getCodePoint(p,d+(w.isSurrogate?2:1)))?(q.push(y.code),a.isValidCombination(q)||a.requiresMore(q)?(d+=w.isSurrogate?2:1,w=y,x+=y.isSurrogate?2:1):(q.pop(),A=!1)):A=!1;if(A&&a.couldHaveMore(q))for(;A&&a.couldHaveMore(q);)(y=a.getCodePoint(p,d+(w.isSurrogate?2:1)))?(q.push(y.code),a.isValidCombination(q)||
a.couldHaveMore(q)?(d+=w.isSurrogate?2:1,w=y,x+=y.isSurrogate?2:1):(q.pop(),A=!1)):A=!1;if(a.isValidCombination(q)){m=a.editor.selection.getBookmark();h(l,d+(w.isSurrogate?2:1)-x);b(l,d+(w.isSurrogate?2:1));var t={id:"mceEmoticon"+g,emoticonId:a.getId(q)},A=tinymce.activeEditor.dom.create("span",{id:t.id,"class":"mceItem mceEmoticon mceNonEditable","data-mce-json":s.serialize(t,"'"),contenteditable:"false"});A.appendChild(document.createTextNode(tinymce.util.I18n.translate("???")));a.editor.selection.setRng(f);
a.editor.selection.setNode(A);a.getPreview(t,function(d){var h=a.editor.dom.get(t.id);h&&(h.innerHTML=d)});n=u=!0;a.editor.selection.moveToBookmark(m)}}w.isSurrogate&&d++}})();n&&(a.editor.selection.moveToBookmark(m),a.editor.nodeChanged())};a.replaceEmojiInText=function(d){for(var h,b=0;b<d.length;b++){var f=a.getCodePoint(d,b);h=a.isStart(f.code);var c=!0,l,m=b;if(h){h=f.isSurrogate?2:1;g++;var p=[];p.push(f.code);if(a.requiresMore(p))for(;c&&a.requiresMore(p);)(l=a.getCodePoint(d,b+(f.isSurrogate?
2:1)))?(p.push(l.code),a.isValidCombination(p)||a.requiresMore(p)?(b+=f.isSurrogate?2:1,f=l,h+=l.isSurrogate?2:1):(p.pop(),c=!1)):c=!1;if(c&&a.couldHaveMore(p))for(;c&&a.couldHaveMore(p);)(l=a.getCodePoint(d,b+(f.isSurrogate?2:1)))?(p.push(l.code),a.isValidCombination(p)||a.couldHaveMore(p)?(b+=f.isSurrogate?2:1,f=l,h+=l.isSurrogate?2:1):(p.pop(),c=!1)):c=!1;a.isValidCombination(p)&&(c="[emoticon:"+a.getId(p)+"]",d=d.substr(0,m)+c+d.substr(m+h),b+=h-(f.isSurrogate?2:1))}f.isSurrogate&&b++}return d};
a.textToSpan=function(d){var a=this,h=a.editor;if(d.parent){for(var b=new q("div"),f=/\[emoticon:([^\]]+)\]/g,c,l=0;c=f.exec(d.value);)(function(){var f={id:"mceEmoticon"+g,emoticonId:RegExp.$1};if(0<c.index)for(var p=h.parser.parse(a.resolveWhitespace(d.value.substr(l,c.index-l))).getAll("p"),m=0;m<p.length;m++)for(var k;null!=(k=p[m].walk());)b.append(k);p=new q("span",1);b.append(p);p.attr({id:f.id,"class":"mceItem mceEmoticon mceNonEditable","data-mce-json":s.serialize(f,"'"),contenteditable:"false"});
m=new q("#text",3);m.raw=!0;m.value=tinymce.util.I18n.translate("???");p.append(m);a.getPreview(f,function(d){var a=h.dom.get(f.id);a&&(a.innerHTML=d)})})(),l=f.lastIndex,g++;if(0<l){if(l<d.value.length)for(var f=h.parser.parse(a.resolveWhitespace(d.value.substr(l))).getAll("p"),p=0;p<f.length;p++)for(var m;null!=(m=f[p].walk());)b.append(m);d.replace(b);b.unwrap()}}};a.getPreview=function(d,h){tinymce.util.XHR.send({url:a.getCallbackUrl({t:"p",emoticonId:d.emoticonId}),success:function(d){d=tinymce.util.JSON.parse(d);
try{d&&d.html?h(d.html):h("")}catch(a){}},error:function(d){try{h("")}catch(a){}}})};a.searchForEmoticons=function(d,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"searchemoticons",query:d}),success:function(h){h=tinymce.util.JSON.parse(h);try{h&&h.emoticons?a(d,h.emoticons):a(d,null)}catch(b){}},error:function(h){try{a(d,null)}catch(b){}}})};a.loadEmoticonCollections=function(d){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"listcollections"}),success:function(a){a=tinymce.util.JSON.parse(a);
try{a&&a.collections?d(a.collections):d(null)}catch(h){}},error:function(a){try{d(null)}catch(h){}}})};a.loadEmoticons=function(d,a){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"listemoticons",collectionId:d}),success:function(h){h=tinymce.util.JSON.parse(h);try{h&&h.emoticons?a(d,h.emoticons):a(d,null)}catch(b){}},error:function(h){try{a(d,null)}catch(b){}}})};a.loadEmoji=function(){tinymce.util.XHR.send({url:a.url+"../../../apis/emoticons?t=emojijson",success:function(d){d=tinymce.util.JSON.parse(d);
try{d&&(k=d)}catch(a){}},error:function(d){}})};a.getCallbackUrl=function(d){for(var a=this.url+"../../../apis/emoticons?",h={},b=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),f=0;f<b.length;f++){var c=b[f].split(/=/);2==c.length&&(h[c[0]]=c[1])}for(var l in d)h[encodeURIComponent(l)]=encodeURIComponent(d[l]);d=!0;for(l in h)d?d=!1:a+="&",a+=l+"="+h[l];return a};var y=!0===c.getParam("evolution_emoticons");c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(d){for(var h=
d.length;h--;)a.textToSpan(d[h])});c.serializer.addNodeFilter("span",function(d,h,b){h=d.length;for(var f;h--;)f=d[h],-1!==(f.attr("class")||"").indexOf("mceEmoticon")&&a.spanToObject(f,b)});c.on("keyup",function(d){a.parseEmojiInLine();if(y)return a.handleKeyUp(c,d)},!0);y&&(c.on("keydown",function(d){return a.handleKeyDown(c,d)},!0),c.on("click",function(){a.hideEmoticons()}))});y&&(c.addCommand("mceInsertEmoticon",function(){a.openDialog()}),c.addMenuItem("emoticon",{text:"Insert emoticon",icon:"emoticons",
cmd:"mceInsertEmoticon",context:"insert",prependToContext:!0}));c.on("ResolveName",function(d){"span"===d.name&&c.dom.hasClass(d.target,"mceEmoticon")&&(d.name=tinymce.util.I18n.translate("emoticon"))});c.on("PastePreProcess",function(d){d.content=a.replaceEmojiInText(d.content)});c.on("BeforeSetContent",function(d){d.content=a.replaceEmojiInText(d.content)});c.addButton("emoticonremove",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(d){return c.dom.is(d,
"span.mceEmoticon")&&c.getBody().contains(d)},"emoticonremove");a.loadEmoji()});(function(){function c(t,q,s){return t?t.is("body")?t.css(q)==s:t.css(q)==s?c(t.parent(),q,s):!1:!1}tinyMCE.$.cssHooks.fontFamily={get:function(t){if(t&&("#"==t.nodeName.substr(0,1)||"BODY"==t.nodeName))return"inherit";t=$(t);var q=t.css("font-family");return c(t.parent(),"font-family",q)?"inherit":q}};tinyMCE.$.cssHooks.fontSize={get:function(t){if(t&&("#"==t.nodeName.substr(0,1)||"BODY"==t.nodeName))return"inherit";
t=$(t);var q=t.css("font-size");return c(t.parent(),"font-size",q)?"inherit":q}}})();tinymce.PluginManager.add("enhancements",function(c,t){function q(d,a){for(var h=0;h<a.length;h++)if(d.nodeName==a[h])return!0;return d.parentNode?q(d.parentNode,a):!1}function s(){b.enhancements_initialheight=$(c.getContainer()).height();c.save();c.remove()}function g(){if(tinymce.EditorManager.get(a))return!1;var d=new tinymce.Editor(a,b,tinymce);d.render();$(d.getContainer()).css({display:""});return!0}var a=c.id,
k,f,b=c.settings,m=null;window.mceReflow=window.mceReflow||{};k=$.telligent.evolution.messaging.subscribe("reflow.reflowstart",function(d){$.telligent.evolution.messaging.unsubscribe(k);window.mceReflow[a]=!0;s()});f=$.telligent.evolution.messaging.subscribe("reflow.reflowend",function(d){window.mceReflow[a]&&(g()&&$.telligent.evolution.messaging.unsubscribe(f),window.mceReflow[a]=!1)});c.on("remove",function(d){window.mceReflow[a]||$.telligent.evolution.messaging.unsubscribe(f);$.telligent.evolution.messaging.unsubscribe(k)});
c.on("contextmenu",function(d){(""==$.trim(c.selection.getContent({format:"text"}))||d.shiftKey)&&q(d.target,["TABLE","TBODY","TR","TH","TD"])||d.stopImmediatePropagation()},!0);c.on("PreInit",function(){var d=$(c.getContainer());c.settings.enhancements_wrappercss&&d.addClass(c.settings.enhancements_wrappercss);d.addClass("mce-editor-blur").removeClass("mce-editor-focus");d.css({height:(b.enhancements_initialheight||c.settings.height||300)+"px",overflow:"hidden"})});c.on("Init",function(){window.setTimeout(function(){$(c.getContainer()).css({height:"auto",
overflow:"visible"})},10)});c.on("focus",function(){$(c.getContainer()).removeClass("mce-editor-blur").addClass("mce-editor-focus")});c.on("blur",function(){$(c.getContainer()).addClass("mce-editor-blur").removeClass("mce-editor-focus")});0<=c.settings.plugins.indexOf("autoresize")&&(c.settings.autoresize_max_height=0.67*$(window).height(),$(window).on("resized",function(){c.settings.autoresize_max_height=0.67*$(window).height()}));if(c.settings.enhancements_placeholder){var n=$('<div class="mce-placeholder"></div>').html(c.settings.enhancements_placeholder).on("click",
function(){c.execCommand("mceFocus",!1)}),l=!0,h=function(){var d=c.getContent();return d&&0<d.length&&!/^(<p>\s*?<\/p>|\s*|<div>\s*?<\/div>)*$/i.test(d)?!0:!1};c.on("init",function(){$(c.getContentAreaContainer()).css("position","relative").append(n);h()?n.hide():n.show()});c.on("focus",function(){n.hide();l=!1});c.on("blur",function(){h()?n.hide():n.show();l=!0});c.on("change setContent",function(){l&&(h()?n.hide():n.show())})}c.addMenuItem("removelink",{text:"Remove link",cmd:"unlink",context:"edit",
prependToContext:!0,onPostRender:function(d){d.control.hide();c.on("NodeChange",function(){"A"==c.selection.getNode().nodeName?d.control.show():d.control.hide()},!0)}});c.addMenuItem("editlink",{text:"Edit link",icon:"link",cmd:"mceLink",context:"edit",prependToContext:!0,onPostRender:function(d){d.control.hide();c.on("NodeChange",function(){"A"==c.selection.getNode().nodeName?d.control.show():d.control.hide()},!0)}});c.addMenuItem("insertlink",{text:"Insert link",icon:"link",cmd:"mceLink",context:"insert",
prependToContext:!0,onPostRender:function(d){d.control.hide();c.on("NodeChange",function(){"A"==c.selection.getNode().nodeName?d.control.hide():d.control.show()},!0)}});c.addMenuItem("indent",{text:"Indent",icon:"indent",cmd:"indent",context:"format"});c.addMenuItem("outdent",{text:"Outdent",icon:"outdent",cmd:"outdent",context:"format"});c.on("dblclick",function(d){"A"==c.selection.getNode().nodeName&&c.execCommand("mceLink")});return{moveTo:function(d){$("#"+a).parent()[0]!=$(d)[0]&&(s(),$("#"+
a).appendTo(d),g())},focusAndView:function(){var d=function(){var a=$(c.getContainer()),h=a.offset();if(a=a.height()){var b=$(window),f=b.scrollTop(),b=b.height(),l=Math.max(0,b-$("body").height());f+b<h.top+a?$("body, html").animate({scrollTop:(a>b-l?h.top-l:h.top-(b-a-5))+"px"},200,"swing",function(){c.focus()}):f+l>h.top?$("body, html").animate({scrollTop:h.top-l+"px"},200,"swing",function(){c.focus()}):c.focus()}else window.clearTimeout(m),m=window.setTimeout(function(){d()},50)};d()}}});tinymce.PluginManager.add("hashtags",
function(c,t){var q=tinymce.html.Node,s=tinymce.util.JSON,g=!1,a=!1,k=/[-_~`!@#$%^&*()=+{[}\]\\|;:'",<.> \s\t]+/i,f,b,m={container:null,selected:null,selectedIndex:-1},n=1,l=this;l.editor=c;l.url=t;l.handleKeyDown=function(h,d){if(!this.disabledState&&g){if(40==d.keyCode)return this.highlightNextHashtag(),this.cancelEvent(d);if(38==d.keyCode)return this.highlightPreviousHashtag(),this.cancelEvent(d);if(13==d.keyCode)return this.selectHashtag(h,this.getCurrentWord(h)),a=!1,this.cancelEvent(d);if(27==
d.keyCode)return a=!1,this.hideHashtags(),this.cancelEvent(d)}};l.cancelEvent=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();return!1};l.getLastTypedCharacter=function(a,d){var b=a.getDoc(),f=a.selection.getSel();if(f.focusNode&&f.focusOffset){if(b=f.focusNode.nodeValue,0<=f.focusOffset-1&&b&&b.length>=f.focusOffset)return b.charAt(f.focusOffset-1)}else if(b.selection&&b.selection.createRange){f=b.selection.createRange();if(!(f.parentElement&&f.moveToPoint&&f.moveStart&&
f.getBoundingClientRect))return"";if(null!=f.parentElement())try{f.parentElement().focus()}catch(c){}f=b.selection.createRange();b=f.getBoundingClientRect();0==b.left&&0==b.top&&(f.moveToElementText(f.parentElement()),b=f.getBoundingClientRect(),b.left=b.right);b.left+=0==f.boundingLeft?b.right-b.left:0;b.top=(b.bottom+b.top)/2;f.moveToPoint(b.left,b.top);f.moveStart("character",-1);return f.text}return""};l.handleKeyUp=function(h,d){if(!this.disabledState){var c=this.getLastTypedCharacter(h,d);(g||
a||"#"==c)&&(40!=d.keyCode&&38!=d.keyCode&&13!=d.keyCode&&27!=d.keyCode)&&(c=this.getCurrentWord(h),a||(f=!0,b=""),256<c.length||""==c||k.test(c.substr(1))?(a=!1,this.hideHashtags()):(a=!0,2<c.length&&(f||c.length-1<=b.length||c.substr(1,b.length)!=b)?(g=!0,this.showHashtags(h,c.substr(1))):this.hideHashtags()))}};l.highlightNextHashtag=function(){m.container&&(m.selected&&m.container.childNodes[0].childNodes.length>m.selectedIndex+1)&&(m.selected.className="",m.selectedIndex++,m.selected=m.container.childNodes[0].childNodes[m.selectedIndex],
m.selected.className="mceHashtagsSelected")};l.highlightPreviousHashtag=function(){m.container&&(m.selected&&0<m.container.childNodes[0].childNodes.length&&0<m.selectedIndex)&&(m.selected.className="",m.selectedIndex--,m.selected=m.container.childNodes[0].childNodes[m.selectedIndex],m.selected.className="mceHashtagsSelected")};l.setHighlightdHashtag=function(a){m.container&&(m.selected&&m.container.childNodes[0].childNodes.length>a&&0<=a)&&(m.selected.className="",m.selectedIndex=a,m.selected=m.container.childNodes[0].childNodes[m.selectedIndex],
m.selected.className="mceHashtagsSelected")};l.showHashtags=function(a,d){var c=this;if(!m.container){m.container=document.createElement("div");a.dom.setAttrib(m.container,"class","mceHashtagsList");a.dom.setAttrib(m.container,"style","position:absolute; z-index: 200001;");var l=document.createElement("ul");m.container.appendChild(l);document.body.appendChild(m.container)}m.selected=null;m.container.childNodes[0].innerHTML="";var k=document.createElement("li");k.innerHTML=tinymce.util.I18n.translate("Loading...");
m.container.childNodes[0].appendChild(k);m.container.style.display="block";var l=this.getWindowScrollOffset(window),n=a.dom.getPos(a.getContentAreaContainer()),g=this.getWindowScrollOffset(a.getWin()),s=a.dom.getPos(a.selection.getNode()),q=0,v=0,v=a.selection.getRng();v.expand&&v.expand("word");var r=null;0==v.getClientRects().length?v.parentElement&&v.getBoundingClientRect&&v.moveToPoint&&v.moveStart?(v.moveToElementText(v.parentElement()),r=v.getBoundingClientRect(),r.left=r.right,r.left+=0==v.boundingLeft?
r.right-r.left:0,v.moveToPoint(r.left,r.top),v.moveStart("character",-1),r=v.getClientRects()[0]):v.insertNode&&(q=a.getWin().document.createElement("span"),v.insertNode(q),r=a.dom.getPos(q),r={left:r.x,top:r.y,width:0,height:q.offsetHeight},q.parentNode.removeChild(q)):r=v.getClientRects()[0];r&&(!r.width&&!r.height&&r.right&&r.bottom)&&(r={width:r.right-r.left,height:r.bottom-r.top,left:r.left-n.x,top:r.top-n.y});r?(q=r.top+r.height,v=r.left):(q=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),
"font-size",!0))+s.y,v=s.x);q+n.y>$(window).height()/2?(m.container.style.bottom=$("body").outerHeight()-(n.y+l.y+q-g.y)+r.height+"px",m.container.style.left=n.x+l.x+v-g.x+"px",m.container.style.top="auto"):(m.container.style.top=n.y+l.y+q-g.y+"px",m.container.style.left=n.x+l.x+v-g.x+"px",m.container.style.bottom="auto");m.lastSearchText=d;window.clearTimeout(m.searchHandle);var F=a.selection.getBookmark(2);m.searchHandle=window.setTimeout(function(){c.searchForHashtags(d,function(d,l){if(m.lastSearchText==
d)if(m.selected=null,m.container.childNodes[0].innerHTML="",l&&0!=l.length){f=!0;b=d;for(var n=0;n<l.length;n++)k=document.createElement("li"),k.style.cursor="pointer",k.innerHTML=l[n].previewhtml,k.onclick=function(){a.selection.moveToBookmark(F);c.selectHashtag(a,c.getCurrentWord(a))},k.onmouseover=function(){c.setHighlightdHashtag(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(k,"data-index",n),a.dom.setAttrib(k,"data-tagname",l[n].name),m.container.childNodes[0].appendChild(k),
m.selected||(m.selectedIndex=n,m.selected=k,m.selected.className="mceHashtagsSelected")}else f&&(b=d.substr(0,d.length-1),f=!1),c.hideHashtags()})},249)};l.hideHashtags=function(a){m.container&&(m.container.style.display="none",m.selected=null,m.selectedIndex=-1);g=!1};l.getCurrentWord=function(a){var d=a.getDoc();a=a.selection.getSel();if(a.focusNode&&a.focusOffset){var d=a.focusNode.nodeValue,b=a.focusOffset-1;if(null==d||0==d.length)return"";a=0;for(var f=b;0<=f;f--)if("#"==d.charAt(f)){a=f;break}d=
d.substr(a,b+1-a);if(0<d.length&&"#"==d.charAt(0).toString())return d}else if(d.selection&&d.selection.createRange){a=d.selection.createRange();if(!(a.parentElement&&a.moveToPoint&&a.moveStart&&a.getBoundingClientRect))return"";if(null!=a.parentElement())try{a.parentElement().focus()}catch(c){}a=d.selection.createRange();d=a.getBoundingClientRect();0==d.left&&0==d.top&&(a.moveToElementText(a.parentElement()),d=a.getBoundingClientRect(),d.left=d.right);d.left+=0==a.boundingLeft?d.right-d.left:0;d.top=
(d.bottom+d.top)/2;a.moveToPoint(d.left,d.top);a.moveStart("word",-1);a.moveStart("character",-1);d=a.text;a=0;for(f=d.length-1;0<=f;f--)if("#"==d.charAt(f)){a=f;break}d=d.substr(a,d.length-a);if(0<d.length&&"#"==d.charAt(0).toString())return d}return""};l.selectHashtag=function(a,d){if(!(0>=d.length)&&m.selected){var b=a.selection.getRng();if(b.setStart)b.setStart(b.startContainer,b.startOffset-d.length);else if(b.parentElement&&b.getBoundingClientRect&&b.moveToPoint&&b.moveStart){var f=b.getBoundingClientRect();
0==f.left&&0==f.top&&(b.moveToElementText(b.parentElement()),f=b.getBoundingClientRect(),f.left=f.right,f.left+=0==b.boundingLeft?f.right-f.left:0,b.moveToPoint(f.left,f.top));b.moveStart("character",-1*d.length)}f={id:"mceHashtag"+(new Date).getTime(),tagName:a.dom.getAttrib(m.selected,"data-tagname")};a.selection.setRng(b);a.selection.setContent('<span contenteditable="false" class="mceItem mceHashtag mceNonEditable" id="'+f.id+'" data-mce-json="'+s.serialize(f,"'")+'">'+m.selected.innerHTML+"</span>");
a.nodeChanged();this.hideHashtags()}};l.isHashtagSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceHashtag")};l.spanToObject=function(a,d){var b,f;(b=a.attr("data-mce-json"))&&!a.isEmpty()&&(b=s.parse(b),b.tagName&&(f=new q("#text",3),f.raw=!0,f.value="[tag:"+b.tagName+"]"));f?a.replace(f):a.remove()};l.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};l.textToSpan=
function(a){var d=this,b=d.editor;if(a.parent){for(var f=new q("div"),c=/\[tag:([^\]]+)\]/g,l,m=0;l=c.exec(a.value);)(function(){var c={id:"mceHashtag"+n,tagName:l[1]};if(0<l.index)for(var k=b.parser.parse(d.resolveWhitespace(a.value.substr(m,l.index-m))).getAll("p"),g=0;g<k.length;g++)for(var x;null!=(x=k[g].walk());)f.append(x);k=new q("span",1);f.append(k);k.attr({id:c.id,"class":"mceItem mceHashtag mceNonEditable","data-mce-json":s.serialize(c,"'"),contenteditable:"false"});g=new q("#text",3);
g.raw=!0;g.value=tinymce.util.I18n.translate("???");k.append(g);d.getHashtagPreview(c,function(d){var a=b.dom.get(c.id);a&&(a.innerHTML=d)})})(),m=c.lastIndex,n++;if(0<m){if(m<a.value.length)for(var c=b.parser.parse(d.resolveWhitespace(a.value.substr(m))).getAll("p"),k=0;k<c.length;k++)for(var g;null!=(g=c[k].walk());)f.append(g);a.replace(f);f.unwrap()}}};l.getWindowScrollOffset=function(a){var d=0,b=0;"number"==typeof a.pageXOffset?(d=a.pageXOffset,b=a.pageYOffset):a.document.body&&(a.document.body.scrollLeft||
a.document.body.scrollTop)?(d=a.document.body.scrollLeft,b=a.document.body.scrollTop):a.document.documentElement&&(a.document.documentElement.scrollLeft||a.document.documentElement.scrollTop)&&(d=document.documentElement.scrollLeft,b=document.documentElement.scrollTop);return{x:d,y:b}};l.getHashtagPreview=function(a,d){a.tagName?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p",tagname:a.tagName}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.html?0==a.html.indexOf("#")?d(a.html.substr(1)):
d(a.html):d("")}catch(b){}},error:function(a){try{d("")}catch(b){}}}):d("")};l.searchForHashtags=function(a,d){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"s",query:a}),success:function(b){b=tinymce.util.JSON.parse(b);try{b&&b.hashtags?d(a,b.hashtags):d(a,null)}catch(f){}},error:function(b){try{d(a,null)}catch(f){}}})};l.getCallbackUrl=function(a){for(var d=this.url+"../../../apis/hashtags?",b={},f=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),c=0;c<f.length;c++){var l=f[c].split(/=/);
2==l.length&&(b[l[0]]=l[1])}for(var m in a)b[encodeURIComponent(m)]=encodeURIComponent(a[m]);a=!0;for(m in b)a?a=!1:d+="&",d+=m+"="+b[m];return d};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(a){for(var d=a.length;d--;)l.textToSpan(a[d])});c.serializer.addNodeFilter("span",function(a,d,b){d=a.length;for(var f;d--;)f=a[d],-1!==(f.attr("class")||"").indexOf("mceHashtag")&&l.spanToObject(f,b)});c.on("keydown",function(a){return l.handleKeyDown(c,a)},!0);c.on("keyup",function(a){return l.handleKeyUp(c,
a)},!0);c.on("click",function(){l.hideHashtags()})});c.on("ResolveName",function(a){"span"===a.name&&c.dom.hasClass(a.target,"mceHashtag")&&(a.name=tinymce.util.I18n.translate("hashtag"))});c.addMenuItem("removehashtag",{text:"Remove hashtag",cmd:"mceRemoveHashtag",stateSelector:"span.mceHashtag",context:"insert",prependToContext:!0,onPostRender:function(a){a.control.hide();c.on("NodeChange",function(){var d,b;d=c.dom.getParent(c.selection.getStart(),function(a){return c.dom.hasClass(a,"mceHashtag")});
b=c.dom.getParent(c.selection.getEnd(),function(a){return c.dom.hasClass(a,"mceHashtag")});d||b?a.control.show():a.control.hide()},!0)}});c.addCommand("mceRemoveHashtag",function(){var a,d;d=c.selection.getNode();l.isHashtagSpan(d)&&(a=c.dom.getAttrib(d,"data-mce-json"))&&(a=s.parse(a));a&&c.dom.setOuterHTML(d,d.innerHTML)});c.addButton("hashtagremove",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(a){return c.dom.is(a,"span.mceHashtag")&&c.getBody().contains(a)},
"hashtagremove")});tinymce.PluginManager.add("media",function(c,t){var q=tinymce.html.Node,s=tinymce.util.JSON,g=0,a=this,k=!1;a.editor=c;a.url=t;a.isMediaSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceInsertMediaItem")};a.createData=function(a,b){var c=Math.round(0.8*jQuery(this.editor.getDoc()).width()),k=Math.round(0.8*jQuery(this.editor.getDoc()).height());if(320<c||!b)c=320;if(240<k||!b)k=240;c>tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&
(c=tinyMCE_TelligentEvolutionOptions.MediaMaxWidth);k>tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&(k=tinyMCE_TelligentEvolutionOptions.MediaMaxHeight);return{id:"mceInsertMedia"+(new Date).getTime(),src:a,width:c,height:k}};a.openDialog=function(a){function b(a){return/float:\s*left/i.test(a)?"float:left;":/float:\s*right/i.test(a)?"float:right;":""}function c(){var a=$(x.getEl());d.embedAsHtml&&d.html?($(".mcemedia-altcontainer, .mcemedia-alignmentcontainer",
a).show(),$(".mcemedia-previewwrapper",a).height(y-($(".mcemedia-altcontainer",a).outerHeight()+$(".mcemedia-alignmentcontainer",a).outerHeight()))):($(".mcemedia-altcontainer, .mcemedia-alignmentcontainer",a).hide(),$(".mcemedia-previewwrapper",a).css("height",""))}function k(){var a=$(x.getEl());$(".mcemedia-prev",a).hide();$(".mcemedia-prevloading",a).show();g.getPreview(d,function(b){try{b&&b.html&&0<b.html.length?(d.embedAsHtml=b.embedAsHtml,d.escapedSrc=b.url,d.html=b.html,c(),$(".mcemedia-prev",
a).html(b.html)):d.src&&0<d.src.length?(d.embedAsHtml=!1,d.escapeSrc=null,d.html=null,c(),b&&b.error?$(".mcemedia-prev",a).text(b.error):$(".mcemedia-prev",a).text(tinymce.util.I18n.translate("No preview is available"))):(d.embedAsHtml=!1,d.escapeSrc=null,d.html=null,c(),$(".mcemedia-prev",a).text(tinymce.util.I18n.translate("No file or URL is selected"))),$(".mcemedia-prevloading",a).hide(),$(".mcemedia-prev",a).show(),b&&b.html&&0<b.html.length?(v=!0,$(".mce-primary button",a).removeAttr("disabled")):
(v=!1,$(".mce-primary button",a).attr("disabled","disabled"))}catch(f){}})}function l(a){var b=$(x.getEl());if(!a){d.type=$(".mcemedia-type",b).val();d.width=isNaN(parseInt($(".mcemedia-width",b).val(),10))?0:parseInt($(".mcemedia-width",b).val(),10);d.height=isNaN(parseInt($(".mcemedia-height",b).val(),10))?0:parseInt($(".mcemedia-height",b).val(),10);var f=d.src;"url"==$(".mcemedia-type",b).val()?d.src=$(".mcemedia-url",b).val():"upload"==$(".mcemedia-type",b).val()?d.src=r:"search"==$(".mcemedia-type",
b).val()&&(0<$(".mcemedia-search",b).glowLookUpTextBox("count")?d.src=$(".mcemedia-search",b).glowLookUpTextBox("getByIndex",0).Value:d.src="");if(f!=d.src)d.embedAsHtml=!1,d.escapedSrc=d.src,d.html="";else if(d.embedAsHtml&&(f=$(".mcemedia-prev img",b),0<f.length)){f.attr("alt",$(".mcemedia-alt").val());var c=$(".mcemedia-alignment").val();""!=c?(f.attr("style",c),"float:right;"==c?f.attr("class","align-right"):"float:left;"==c&&f.attr("class","align-left")):(f.attr("style",null),f.attr("class",
null));d.html=$(".mcemedia-prev",b).html()}}else if(!d.type||"url"!=d.type&&"upload"!=d.type&&"search"!=d.type||d.src&&0<d.src.length||"upload"==d.type&&0==$(".uploadoption",b).length)d.type="url";$(".mcemedia-urlcontainer",b).hide();$(".mcemedia-uploadcontainer",b).hide();$(".mcemedia-searchcontainer",b).hide();$(".mcemedia-"+d.type+"container",b)&&$(".mcemedia-"+d.type+"container",b).show();$(".mcemedia-type",b).val(d.type);$(".mcemedia-width",b).val(0<d.width?d.width:"");$(".mcemedia-height",b).val(0<
d.height?d.height:"");a&&($(".mcemedia-alt",b).val(d.alt||""),$(".mcemedia-alignment",b).val(d.alignment||""));a&&d.src&&$(".mcemedia-url",b).val(d.src)}function h(){var a=$(x.getEl());v=!1;$(".mce-primary button",a).attr("disabled","disabled");l(!1);k()}var d,p,g=this,x,q="Insert image/video/file",y;p=g.editor.selection.getNode();if(g.isMediaSpan(p)){if(d=g.editor.dom.getAttrib(p,"data-mce-json")){d=s.parse(d);var q=parseInt($(p).css("width"),10)||d.width,w=parseInt($(p).css("height"),10)||d.height;
if(w!=d.renderedHeight||q!=d.renderedWidth)d.height=w,d.width=q;q="Edit media"}}else if(p.src){var z=p.src,q=w=null;(0==z.indexOf(window.location.origin)||"/"==z.substr(0,1))&&0<=z.indexOf("/resized-image/")&&/\/resized\-image\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/gi.exec(z)&&(z=$.telligent.evolution.site.getBaseUrl()+"cfs-file/__key/"+RegExp.$3,q=RegExp.$1,w=RegExp.$2);q=g.editor.dom.getAttrib(p,"width")||q;w=g.editor.dom.getAttrib(p,"height")||w;d={src:z,width:q,height:w,alt:$(p).attr("alt")||
"",alignment:b($(p).attr("style")||"")};q="Edit image"}d||(d=g.createData(g.editor.selection.getContent({format:"text"})),d.type=a);g.resize(d);var v=!1,r=null;x=g.editor.windowManager.open({title:tinymce.util.I18n.translate(q),body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr><td><label for="type">'+tinymce.util.I18n.translate("From")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td>\t\t\t<select id="type" name="type" class="mce-textbox mcemedia-type" style="width: 260px;">\t\t\t\t<option value="url">'+
tinymce.util.I18n.translate("Web (URL)")+'</option>\t\t\t\t<option class="mcemedia-uploadoption" value="upload">'+tinymce.util.I18n.translate("File Upload")+'</option>\t\t\t\t<option class="mcemedia-searchoption" value="search">'+tinymce.util.I18n.translate("Community (Search)")+'</option>\t\t\t</select>\t\t</td>\t</tr>\t</table></td></tr><tr class="mcemedia-urlcontainer"><td><label for="url">'+tinymce.util.I18n.translate("URL")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><input id="url" name="url" type="text" value="" class="mce-textbox mcemedia-url" style="width: 260px;" /></td>\t</tr>\t</table></td></tr><tr class="mcemedia-uploadcontainer" style="display: none;"><td><label for="file">'+
tinymce.util.I18n.translate("File")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><div id="file" class="mcemedia-file"></div></td>\t</tr>\t</table></td></tr><tr class="mcemedia-searchcontainer" style="display: none;"><td valign="top"><label for="search">'+tinymce.util.I18n.translate("Search")+'</label></td><td>\t<table role="presentation" border="0" cellspacing="0" cellpadding="0">\t<tr>\t\t<td><input id="search" name="search" type="text" class="mcemedia-search" value="" style="width: 260px;" /></td>\t</tr>\t</table></td></tr><tr><td><label for="width">'+
tinymce.util.I18n.translate("Dimensions")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>\t\t\t<td><input type="text" id="width" name="width" class="mce-textbox mcemedia-width" value="" size="3" /> '+tinymce.util.I18n.translate("x")+' <input class="mce-textbox mcemedia-height" type="text" id="height" name="height" value="" size="3" /></td>\t\t</tr>\t</table></td></tr><tr class="mcemedia-altcontainer" style="display: none;"><td><label for="alt">'+
tinymce.util.I18n.translate("Alternate Text")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>\t\t\t<td><input type="text" id="alt" name="alt" class="mce-textbox mcemedia-alt" value="" style="width: 260px;" /></td>\t\t</tr>\t</table></td></tr><tr class="mcemedia-alignmentcontainer" style="display: none;"><td><label for="alignment">'+tinymce.util.I18n.translate("Alignment")+'</label></td><td>\t<table role="presentation" border="0" cellpadding="0" cellspacing="0">\t\t<tr>     <td><select id="alignment" name="alignment" class="mce-textbox mcemedia-alignment" style="width: 260px;">\t\t\t\t<option value="">'+
tinymce.util.I18n.translate("Inline with text")+'</option>\t\t\t\t<option value="float:left;">'+tinymce.util.I18n.translate("Left of text")+'</option>\t\t\t\t<option value="float:right;">'+tinymce.util.I18n.translate("Right of text")+'</option>\t\t\t</select></td>\t\t</tr>\t</table></td></tr></table><div class="mcemedia-previewwrapper"><div class="mcemedia-prevloading" style="display:none">'+tinymce.util.I18n.translate("Loading...")+'</div><div class="mcemedia-prev"></div></div>'}],buttons:[{text:"Ok",
onclick:function(){var a=$(x.getEl());d.src&&v&&(h(),g.editor.execCommand("mceRepaint"),d.embedAsHtml&&d.html?g.editor.selection.setContent(d.html):g.editor.selection.setNode(g.dataToSpan(d)),g.editor.nodeChanged(),$(".mcemedia-file",a).remove(),x.close())},subtype:"primary"},{text:"Cancel",onclick:function(){x.close()}}]});(function(){var a=$(x.getEl());y=$(".mcemedia-previewwrapper",a).innerHeight();$(".mce-primary button",a).attr("disabled","disabled");g.supportsUpload()||$(".mcemedia-uploadoption",
a).remove();g.supportsLocalFiles()||$(".mcemedia-searchoption",a).remove();l(!0);k();$(".mcemedia-search",a).glowLookUpTextBox({delimiter:",",emptyHtml:"",maxValues:1,onGetLookUps:function(a,d){g.searchForMedia(d,function(b){if(d==a.glowLookUpTextBox("getCurrentSearchText")){for(var f=[],c=0;c<b.length;c++)f[f.length]=a.glowLookUpTextBox("createLookUp",b[c].url,b[c].url,b[c].previewHtml,!0);0==f.length&&(f[f.length]=a.glowLookUpTextBox("createLookUp","","",tinymce.util.I18n.translate("No matching files were found."),
!1));a.glowLookUpTextBox("updateSuggestions",f)}})},selectedLookUpsHtml:[]}).bind("glowLookUpTextBoxChange",function(){h()});$(".mcemedia-file",a).glowUpload({fileFilter:null,width:"260px",uploadUrl:g.getUploadUrl()}).bind("glowUploadBegun",function(){$(".mcemedia-fileurl",a).val("")}).bind("glowUploadComplete",function(){g.finalizeFileUpload($(".mcemedia-file",a).glowUpload("val").name,function(a){r=a;h()})});$("input, select",a).on("change",function(){h()})})()};a.getInfo=function(){return{longname:"Insert Media",
author:"Telligent",authorurl:"http://telligent.com",version:"6.5"}};a.getFilename=function(a){var b=a.lastIndexOf("/");return 0<=b&&b<a.length?a.substr(b+1):a+""};a.dataToSpan=function(a,b){var c=this.editor,k;this.resize(a);k=this.editor.dom.create("span",{id:a.id,"class":"mceItem mceNonEditable mceInsertMediaItem","data-mce-json":s.serialize(a,"'"),style:"width:"+a.renderedWith+"px; height:"+a.renderedHeight+"px;",contenteditable:"false",spellcheck:"false"});this.getMediaType(a,function(b,h,d,k,
g){var n=c.dom.get(a.id);n&&(k&&$(n).css({"background-image":"url("+k+")"}).addClass("mceInsertMedaiWithPreview"),$(n).css({width:h+"px",height:d+"px"}).attr("title",g).addClass("mceInsertMediaItem"+b).html("<span>"+g+"</span>"),a.renderedWidth=h,a.renderedHeight=d)});return k};a.dataToHtml=function(a,b){return this.editor.serializer.serialize(this.dataToSpan(a,b),{forced_root_block:"",force_absolute:b})};a.htmlToData=function(a){var b,c;c={};if(b=this.editor.parser.parse(a).getAll("span")[0])if(c=
s.parse(b.attr("data-mce-json")),a=parseInt($(b).css("width"),10),b=parseInt($(b).css("height"),10),b!=c.renderedHeight||a!=c.renderedWidth)c.height=b,c.width=a;this.resize(c);return c};a.spanToObject=function(a,b){var c,k,l;if(c=a.attr("data-mce-json")){c=s.parse(c);for(var h=(a.attr("style")||"").split(";"),d=c.width,g=c.height,u=0;u<h.length;u++)l=h[u].split(":"),"width"==$.trim(l[0])?(l=parseInt(l[1],10))&&(d=l):"height"==$.trim(l[0])&&(l=parseInt(l[1],10))&&(g=l);if(g!=c.renderedHeight||d!=c.renderedWidth)c.height=
g,c.width=d,c.renderedHeight=null,c.renderedWidth=null;c.src&&(this.resize(c),k=new q("#text",3),k.raw=!0,k.value="[View:"+(c.escapedSrc?c.escapedSrc:c.src),k.value=0<c.width?k.value+(":"+c.width):k.value+":0",k.value=0<c.height?k.value+(":"+c.height):k.value+":0",k.value+="]");k?a.replace(k):a.remove()}};a.resizeCfsImg=function(a,b){var c=a.attr("src"),k=a.attr("width")||0,l=a.attr("height")||0;0!=c.indexOf(window.location.origin)&&"/"!=c.substr(0,1)||(0==k||0==l)||/\/resized\-image\/\_\_size\/([0-9]+)x([0-9]+)\/\_\_key\/(.*)/gi.exec(c)&&
(RegExp.$1!=k&&RegExp.$2!=l)&&a.attr({width:null,height:null,src:"/resized-image/__size/"+k+"x"+l+"/__key/"+RegExp.$3,"data-mce-src":"/resized-image/__size/"+k+"x"+l+"/__key/"+RegExp.$3})};a.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};a.textToSpan=function(a){var b=this,c=b.editor;if(a.parent){for(var k=new q("div"),l=/\[view:([^\]]+?)(?:\:([0-9]+)(?:\:([0-9]+))?)?\]/gi,h,d=0;h=l.exec(a.value);)(function(){var l=
RegExp.$1,p=RegExp.$2||0,u=RegExp.$3||0,w={id:"mceInsertMedia"+g++,src:l,width:p,height:u};b.resize(w);if(0<h.index)for(l=c.parser.parse(b.resolveWhitespace(a.value.substr(d,h.index-d))).getAll("p"),p=0;p<l.length;p++)for(;null!=(u=l[p].walk());)k.append(u);l=new q("span",1);k.append(l);l.attr({id:w.id,"class":"mceItem mceNonEditable mceInsertMediaItem",style:"width: "+w.renderedWidth+"px; height:"+w.renderedHeight+"px;","data-mce-json":s.serialize(w,"'"),contenteditable:"false",spellcheck:"false"});
b.getMediaType(w,function(a,d,b,f,h){var l=c.dom.get(w.id);l&&(f&&$(l).css({"background-image":"url("+f+")"}).addClass("mceInsertMedaiWithPreview"),$(l).css({width:d+"px",height:b+"px"}).attr("title",h).addClass("mceInsertMediaItem"+a).html("<span>"+h+"</span>"),w.renderedWidth=d,w.renderedHeight=b)})})(),d=l.lastIndex;if(0<d){if(d<a.value.length)for(var l=c.parser.parse(b.resolveWhitespace(a.value.substr(d))).getAll("p"),p=0;p<l.length;p++)for(var u;null!=(u=l[p].walk());)k.append(u);a.replace(k);
k.unwrap()}}};a.getCallbackUrl=function(a){for(var b=this.url+"../../../apis/media?",c={},k=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),l=0;l<k.length;l++){var h=k[l].split(/=/);2==h.length&&(c[h[0]]=h[1])}for(var d in a)c[encodeURIComponent(d)]=encodeURIComponent(a[d]);a=!0;for(d in c)a?a=!1:b+="&",b+=d+"="+c[d];return b};a.getPreview=function(a,b){var c=this;a.src&&0!=a.src.length?tinymce.util.XHR.send({url:c.getCallbackUrl({t:"gp",url:a.src,width:a.width,height:a.height,contentTypeId:c.editor.getParam("evolution_contenttypeid")||
""}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.html?b(a):a&&a.error?b(a):b("")}catch(c){}},error:function(a){c.editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while attempting to preview the file."));try{b("")}catch(f){}}}):b("")};a.getMediaType=function(a,b){var c=this;a.src&&0!=a.src.length?tinymce.util.XHR.send({url:c.getCallbackUrl({t:"gmt",url:a.src,width:a.width,height:a.height}),success:function(k){k=tinymce.util.JSON.parse(k);try{k&&k.type?b(k.type,
k.width,k.height,k.url,k.label):b("Empty",a.width,a.height,null,c.getFilename(a.src))}catch(l){}},error:function(k){try{b("Empty",a.width,a.height,null,c.getFilename(a.src))}catch(l){}}}):b("Empty",a.width,a.height,null,"")};a.searchForMedia=function(a,b){var c=this;window.clearTimeout(c.searchTimeout);c.searchTimeout=window.setTimeout(function(){a&&0!=a.length?tinymce.util.XHR.send({url:c.getCallbackUrl({t:"s",query:a}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.results?b(a.results):
(a&&a.error&&alert(a.error),b(""))}catch(c){}},error:function(a){try{b([])}catch(c){}}}):b([])},499)};a.getUploadUrl=function(){return tinyMCE_TelligentEvolutionOptions.DirectUploadUrl};a.finalizeFileUpload=function(a,b){a&&0!=a.length?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"fu",file:a,uploadContext:tinyMCE_TelligentEvolutionOptions.DirectUploadContext}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.url?b(a.url):(a&&a.error&&alert(a.error),b(""))}catch(c){}},error:function(a){alert(tinymce.util.I18n.translate("An error occurred while uploading the file."));
try{b("")}catch(c){}}}):b("")};a.supportsUpload=function(){return!0===c.getParam("evolution_upload")};a.supportsLocalFiles=function(){return!0===c.getParam("evolution_localfiles")};a.resize=function(a){a.width>tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&(a.width=tinyMCE_TelligentEvolutionOptions.MediaMaxWidth);a.height>tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&(a.height=tinyMCE_TelligentEvolutionOptions.MediaMaxHeight);
a.renderedWidth&&0!=a.renderedWidth||(a.renderedWidth=!a.width||0>=a.width?0<a.height?Math.round(4*a.height/3):0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth?tinyMCE_TelligentEvolutionOptions.MediaMaxWidth:320:a.width,a.renderedWidth>tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxWidth&&(a.renderedWidth=tinyMCE_TelligentEvolutionOptions.MediaMaxWidth));a.renderedHeight&&0!=a.renderedHeight||(a.renderedHeight=!a.height||0>=a.height?0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight?
tinyMCE_TelligentEvolutionOptions.MediaMaxHeight:Math.round(3*a.renderedWidth/4):a.height,a.renderedHeight>tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&0<tinyMCE_TelligentEvolutionOptions.MediaMaxHeight&&(a.renderedHeight=tinyMCE_TelligentEvolutionOptions.MediaMaxHeight))};a.initializeDirectUpload=function(c){var b=null;jQuery("#"+c.id).glowUpload({fileFilter:null,renderMode:"link",uploadUrl:a.getUploadUrl()}).on("glowUploadError",function(){a.hideShade();editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while uploading a file."));
e.preventDefault();e.stopImmediatePropagation();e.stopPropagation()}).on("glowUploadFileProgress",function(b,c){a.showShade(tinymce.util.I18n.translate("Uploading '{0}' ({1}%)...").replace("{0}",c.name).replace("{1}",c.percent));b.preventDefault();b.stopImmediatePropagation();b.stopPropagation()}).on("glowUploadComplete",function(c,f){a.hideShade();c.preventDefault();c.stopImmediatePropagation();c.stopPropagation();a.finalizeFileUpload(jQuery(this).glowUpload("val").name,function(c){var f={};f.id=
"mceInsertMedia"+(new Date).getTime();f.type="url";f.width=320;f.height=240;f.src=c;f.embedAsHtml=!1;f.escapedSrc=f.src;f.html="";a.getPreview(f,function(d){try{d&&(d.html&&0<d.html.length)&&(d&&d.html&&0<d.html.length)&&(f.embedAsHtml=d.embedAsHtml,f.escapedSrc=d.url,f.html=d.html,a.editor.execCommand("mceRepaint"),b&&(a.editor.selection.moveToBookmark(b),b=null),f.embedAsHtml&&f.html?a.editor.selection.setContent(f.html):a.editor.selection.setNode(a.dataToSpan(f)))}catch(c){}})})}).on("click",function(){b=
a.editor.selection.getBookmark();return!0})};a.showShade=function(c){clearTimeout(a.hideTimeout);var b=jQuery(a.editor.getContentAreaContainer()).width();c?a.shadeMessage.text(c).css({display:"block",width:b+"px"}):a.shadeMessage.css("display","none");a.shade.height(jQuery(a.editor.getContentAreaContainer()).height()).width(b).css("display","block")};a.hideShade=function(){clearTimeout(a.hideTimeout);a.hideTimeout=setTimeout(function(){a.shade.css("display","none");a.shadeMessage.css("display","none")},
999)};a.nodeContainsContent=function(a){for(var b=0;b<a.children.length;b++)if("SPAN"==a.children[b].nodeName)return!0;return!1};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(c){for(var b=c.length;b--;)a.textToSpan(c[b])});c.serializer.addNodeFilter("span",function(c,b,k){b=c.length;var g;if(!k||!k.selection)for(;b--;)g=c[b],-1!==(g.attr("class")||"").indexOf("mceInsertMediaItem")?a.spanToObject(g,k):-1!==(g.attr("src")||"").indexOf("/__key/")&&a.resizeCfsImg(g,k)})});c.on("init",
function(){var f=jQuery("<div></div>").css({position:"absolute",top:"0px",left:"0px"});jQuery(c.getContentAreaContainer()).css("position","relative");jQuery(c.getContentAreaContainer()).append(f);a.shade=jQuery('<div class="mceDragDropShade"></div>').css({position:"absolute",display:"none",left:"0px",top:"0px"});a.shadeMessage=jQuery('<div class="mceDragDropMessage"></div>').css({position:"absolute",display:"none",left:"0px",top:"0px"});f.append(a.shade).append(a.shadeMessage);!a.supportsUpload()||
(k||!jQuery.fn.glowUpload||tinymce.isIE6||tinymce.isIE7||tinymce.isIE8||tinymce.isIE9)||(c.plugins.tips&&c.plugins.tips.defaultTip&&c.plugins.tips.defaultTip(tinymce.util.I18n.translate("Add images and other files by dragging them into the editor.")),k=!0,jQuery(c.getBody()).on("dragover dragenter",function(){a.showShade(tinymce.util.I18n.translate("Upload file(s)"))}),jQuery(c.getBody()).parent().on("dragover dragenter",function(){a.showShade(tinymce.util.I18n.translate("Upload file(s)"))}),jQuery(c.getContainer()).on("dragleave dragend drop mouseout",
function(){a.hideShade()}),jQuery(c.getContainer()).glowUpload({fileFilter:null,renderMode:"dragdrop",uploadUrl:a.getUploadUrl()}).on("glowUploadError",function(){a.hideShade();editor.windowManager.alert(tinymce.util.I18n.translate("An error occurred while uploading a file."))}).on("glowUploadFileProgress",function(b,c){a.showShade(tinymce.util.I18n.translate("Uploading '{0}' ({1}%)...").replace("{0}",c.name).replace("{1}",c.percent))}).on("glowUploadComplete",function(b,f){a.hideShade();a.finalizeFileUpload(f.name,
function(b){var f={};f.id="mceInsertMedia"+(new Date).getTime();f.type="url";f.width=320;f.height=240;f.src=b;f.embedAsHtml=!1;f.escapedSrc=f.src;f.html="";a.getPreview(f,function(b){try{b&&(b.html&&0<b.html.length)&&(b&&b.html&&0<b.html.length)&&(f.embedAsHtml=b.embedAsHtml,f.escapedSrc=b.url,f.html=b.html,c.execCommand("mceRepaint"),f.embedAsHtml&&f.html?c.selection.setContent(f.html):c.selection.setNode(a.dataToSpan(f)))}catch(d){}})})}));a.editor.on("dblclick",function(b){if(c.dom.hasClass(b.target,
"mceInsertMediaItem"))a.openDialog(b.target);else if(c.dom.hasClass(b.target.parentNode,"mceInsertMediaItem"))a.openDialog(b.target.parentNode);else if("IMG"==b.target.nodeName&&b.target.src&&(!b.target.className||0>b.target.className.indexOf("mce"))){for(var f=b.target.parentNode;f&&"BODY"!=f.nodeName;){if(f.className&&0<=f.className.indexOf("mce"))return;f=f.parentNode}a.openDialog(b.target)}});a.editor.on("NodeChange",function(){var b=c.selection.getNode();"A"==b.nodeName&&b.href&&!a.nodeContainsContent(b)?
a.editor.execCommand("mceTip",!1,tinymce.util.I18n.translate("Select 'Convert link to preview' from the 'Edit' menu to preview this link.")):c.dom.hasClass(b,"mceInsertMediaItem")&&a.editor.execCommand("mceTip",!1,tinymce.util.I18n.translate("Select 'Convert preview to link' from the 'Edit' menu to just show a link to this file/site."))},!0)});c.on("PastePreProcess",function(f){function b(a,d,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onreadystatechange=function(a){4==
this.readyState&&(200==this.status&&"blob"==this.responseType?d(new Blob([this.response],{type:this.getResponseHeader("Content-Type")})):b())};c.send()}function k(a,d,b,c){if("image/"!=a.type.substr(0,6))c();else{var f=a.type.substr(6);if("png"!=f&&"gif"!=f&&"jpg"!=f&&"jpeg"!=f&&"pjpeg"!=f)c();else{"pjpeg"==f&&(f="jpeg");var h=Math.ceil(a.size/1048576),l=[],g;for(g=0;g<h;g++)(function(){var b=new FormData;b.append("File",a.slice(1048576*g,Math.min(a.size,1048576*(g+1)),"image/"+f),d+"."+f);b.append("FileName",
d+"."+f);b.append("TotalChunks",h);b.append("CurrentChunk",g);b.append("UploadContextId",tinyMCE_TelligentEvolutionOptions.DirectUploadContext);l.push(jQuery.telligent.evolution.post({url:jQuery.telligent.evolution.site.getBaseUrl()+"api.ashx/v2/cfs/temporary.json",data:b,contentType:!1,processData:!1}))})();jQuery.when.apply(jQuery,l).done(function(a){a&&a.UploadedFile&&a.UploadedFile.DownloadUrl?b(a.UploadedFile.DownloadUrl):c()}).fail(function(){c()})}}}function n(a,d,b,c){var f,h,l,g;a=a.split(/[:;,]/g,
4);if("data"!=a[0]||"base64"!=a[2])c();else if("image"!=a[1].substr(0,5))c();else{var p=a[1].substr(6);if("png"!=p&&"gif"!=p&&"jpg"!=p&&"jpeg"!=p&&"pjpeg"!=p)c();else{"pjpeg"==p&&(p="jpeg");try{h=window.atob(a[3]);l=[];for(f=0;f<h.length;f++)l.push(h.charCodeAt(f));g=new Blob([new Uint8Array(l)],{type:"image/"+p});k(g,d,b,c)}catch(n){c()}}}}function l(d,c,f,h){"data:"==d.substr(0,5)?n(d,c,f,h):b(d,function(a){k(a,c,function(a){f(a)},function(){h()})},function(){tinymce.util.XHR.send({url:a.getCallbackUrl({t:"si",
url:d,fileName:c,uploadContext:tinyMCE_TelligentEvolutionOptions.DirectUploadContext}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.url?f(a.url):h()}catch(d){h()}},error:function(a){h()}})})}function h(d,b,f,h){if(!(a.supportsUpload()&&window.FormData&&window.Blob&&window.Uint8Array&&window.atob&&window.jQuery&&jQuery.telligent&&jQuery.telligent.evolution&&jQuery.telligent.evolution.post))return"";var k="pastedimage"+(new Date).getTime()+"v"+ ++g;l(b,k,function(d){var b=c.dom.get(k);
if(b){var l={};l.id="mceInsertMedia"+k;l.type="url";l.width=f;l.height=h;l.src=d;l.embedAsHtml=!1;l.escapedSrc=l.src;l.html="";a.getPreview(l,function(d){try{d&&(d.html&&0<d.html.length)&&(d&&d.html&&0<d.html.length)&&(l.embedAsHtml=d.embedAsHtml,l.escapedSrc=d.url,l.html=d.html,l.embedAsHtml&&l.html?c.dom.setOuterHTML(b,l.html):c.dom.replace(a.dataToSpan(l),b))}catch(f){}})}},function(){window.setTimeout(function(){c.dom.remove(k)},250)});return'<span id="'+k+'" contenteditable="false" class="mceItem mceNonEditable mceInsertMediaItem mceInsertMediaItem mceInsertMediaItemImage" style="width: '+
f+"px; height: "+h+'px; color: Transparent;">...</span>'}var d=/<(img)\s[^>]*?src="([^"]*)"[^>]*>/gi,p=/width=\"?(\d+)\"?/i,s=/style=\"?[^ "]*?width:\s*(\d+)px/i,q=/height=\"?(\d+)\"?/i,A=/style=\"?[^ "]*?height:\s*(\d+)px/i,y,w=0,z="",v,r;if(0===f.content.indexOf("data:image/"))f.content=h("img",f.content,320,240);else{for(;y=d.exec(f.content);){y.index>w&&(z+=f.content.substr(w,y.index-w));w=NaN;if(r=p.exec(y[0]))w=parseInt(r[1],10);isNaN(w)&&(r=s.exec(y[0]))&&(w=parseInt(r[1],10));isNaN(w)&&(w=
320);v=NaN;if(r=q.exec(y[0]))v=parseInt(r[1],10);isNaN(v)&&(r=A.exec(y[0]))&&(v=parseInt(r[1],10));isNaN(v)&&(v=240);z+=h(y[1],y[2],w,v);w=d.lastIndex}w<f.content.length&&(z+=f.content.substr(w));f.content=z}});c.on("ResolveName",function(a){"span"===a.name&&c.dom.hasClass(a.target,"mceInsertMediaItem")&&(a.name=tinymce.util.I18n.translate("media"))});c.on("NodeChange",function(){var a=c.selection.getNode();c.dom.hasClass(a,"mceInsertMediaItem")&&window.setTimeout(function(){c.selection.controlSelection.showResizeRect(a)},
2)});c.addCommand("mceInsertMedia",function(){a.openDialog("upload")});c.addCommand("mceInsertMediaToPreview",function(){var f=c.selection.getNode();if("A"!=f.nodeName)for(var b=0;b<f.childNodes.length;b++)if("A"==f.childNodes[b].nodeName&&f.childNodes[b].href){f=f.childNodes[b];break}if("A"==f.nodeName){var k=a.createData(f.href,!0);k.renderedWidth=k.width;k.renderedHeight=k.height;a.getPreview(k,function(b){try{b&&(b.html&&0<b.html.length)&&(k.embedAsHtml=b.embedAsHtml,k.escapedSrc=b.url,k.html=
b.html),k.embedAsHtml?$(f).replaceWith(k.html):c.dom.replace(a.dataToSpan(k),f,!1)}catch(l){}})}});c.addCommand("mceInsertMediaToLink",function(){var f,b,k;b=c.selection.getNode();a.isMediaSpan(b)?(f=c.dom.getAttrib(b,"data-mce-json"))&&(f=s.parse(f)):"IMG"==b.nodeName&&b.src&&(f={src:b.src});f&&(k=document.createElement("a"),k.href=f.src,k.innerHTML=f.src,c.dom.replace(k,b,!1))});c.addMenuItem("media",{text:"Insert image/video/file",icon:"media",cmd:"mceInsertMedia",context:"insert",prependToContext:!0});
c.addMenuItem("removemedia",{text:"Convert preview to link",cmd:"mceInsertMediaToLink",icon:"link",context:"edit",prependToContext:!0,onPostRender:function(a){a.control.hide();c.on("NodeChange",function(){var b=c.selection.getNode();c.dom.hasClass(b,"mceInsertMediaItem")?a.control.show():a.control.hide()},!0)}});c.addMenuItem("previewmedia",{text:"Convert link to preview",cmd:"mceInsertMediaToPreview",icon:"media",context:"edit",prependToContext:!0,onPostRender:function(f){f.control.hide();c.on("NodeChange",
function(){var b=c.selection.getNode();"A"==b.nodeName&&b.href&&!a.nodeContainsContent(b)?f.control.show():f.control.hide()},!0)}});c.addMenuItem("editmedia",{text:"Edit media",icon:"media",cmd:"mceInsertMedia",context:"edit",prependToContext:!0,onPostRender:function(a){a.control.hide();c.on("NodeChange",function(){var b=c.selection.getNode();c.dom.hasClass(b,"mceInsertMediaItem")?a.control.show():a.control.hide()},!0)}});c.addMenuItem("editimage",{text:"Edit image",icon:"image",cmd:"mceInsertMedia",
context:"edit",prependToContext:!0,onPostRender:function(a){a.control.hide();c.on("NodeChange",function(){var b=c.selection.getNode();"SPAN"==b.nodeName&&b.src&&(!b.className||0>b.className.indexOf("mce"))?a.control.show():a.control.hide()},!0)}});c.addButton("insertmediadirect",{title:"Insert image/video/file",cmd:"mceInsertMediaIgnore",icon:"image",onPostRender:function(c){a.supportsUpload()&&jQuery.fn.glowUpload?a.initializeDirectUpload(c.control.getEl()):c.control.hide()}});c.addButton("editmedia",
{text:"Edit",cmd:"mceInsertMedia"});c.addButton("removemedia",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addButton("convertmediatolink",{text:"Convert to link",cmd:"mceInsertMediaToLink"});c.addContextToolbar(function(a){if(c.dom.hasClass(a,"mceInsertMediaItem"))return!0;if("IMG"==a.nodeName&&a.src&&(!a.className||0>a.className.indexOf("mce"))){for(a=a.parentNode;a&&"BODY"!=a.nodeName;){if(a.className&&0<=a.className.indexOf("mce"))return!1;a=a.parentNode}return!0}return!1},
"editmedia removemedia convertmediatolink")});tinymce.PluginManager.add("mentions",function(c,t){var q=tinymce.html.Node,s=tinymce.util.JSON,g=!1,a=!1,k,f,b={container:null,selected:null,selectedIndex:-1},m=1,n=this;n.editor=c;n.url=t;n.handleKeyDown=function(b,c){if(!this.disabledState&&g){if(40==c.keyCode)return this.highlightNextMentionable(),this.cancelEvent(c);if(38==c.keyCode)return this.highlightPreviousMentionable(),this.cancelEvent(c);if(13==c.keyCode)return this.selectMentionable(b,this.getCurrentWord(b)),
a=!1,this.cancelEvent(c);if(27==c.keyCode)return a=!1,this.hideMentionables(),this.cancelEvent(c)}};n.cancelEvent=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();return!1};n.getLastTypedCharacter=function(a,b){var d=a.getDoc(),c=a.selection.getSel();if(c.focusNode&&c.focusOffset){if(d=c.focusNode.nodeValue,0<=c.focusOffset-1&&d&&d.length>=c.focusOffset)return d.charAt(c.focusOffset-1)}else if(d.selection&&d.selection.createRange){c=d.selection.createRange();if(!(c.parentElement&&
c.moveToPoint&&c.moveStart&&c.getBoundingClientRect))return"";if(null!=c.parentElement())try{c.parentElement().focus()}catch(f){}c=d.selection.createRange();d=c.getBoundingClientRect();0==d.left&&0==d.top&&(c.moveToElementText(c.parentElement()),d=c.getBoundingClientRect(),d.left=d.right);d.left+=0==c.boundingLeft?d.right-d.left:0;d.top=(d.bottom+d.top)/2;c.moveToPoint(d.left,d.top);c.moveStart("character",-1);return c.text}return""};n.handleKeyUp=function(b,c){if(!this.disabledState){var d=this.getLastTypedCharacter(b,
c);(g||a||"@"==d)&&(40!=c.keyCode&&38!=c.keyCode&&13!=c.keyCode&&27!=c.keyCode)&&(d=this.getCurrentWord(b),a||(k=!0,f=""),256<d.length||""==d?(a=!1,this.hideMentionables()):(a=!0,2<d.length&&(k||d.length-1<=f.length||d.substr(1,f.length)!=f)?(g=!0,this.showMentionables(b,d.substr(1))):this.hideMentionables()))}};n.highlightNextMentionable=function(){b.container&&(b.selected&&b.container.childNodes[0].childNodes.length>b.selectedIndex+1)&&(b.selected.className="",b.selectedIndex++,b.selected=b.container.childNodes[0].childNodes[b.selectedIndex],
b.selected.className="mceMentionablesSelected")};n.highlightPreviousMentionable=function(){b.container&&(b.selected&&0<b.container.childNodes[0].childNodes.length&&0<b.selectedIndex)&&(b.selected.className="",b.selectedIndex--,b.selected=b.container.childNodes[0].childNodes[b.selectedIndex],b.selected.className="mceMentionablesSelected")};n.setHighlightdMention=function(a){b.container&&(b.selected&&b.container.childNodes[0].childNodes.length>a&&0<=a)&&(b.selected.className="",b.selectedIndex=a,b.selected=
b.container.childNodes[0].childNodes[b.selectedIndex],b.selected.className="mceMentionablesSelected")};n.showMentionables=function(a,c){var d=this;if(!b.container){b.container=document.createElement("div");a.dom.setAttrib(b.container,"class","mceMentionablesList");a.dom.setAttrib(b.container,"style","position:absolute; z-index: 200001;");var g=document.createElement("ul");b.container.appendChild(g);document.body.appendChild(b.container)}b.selected=null;b.container.childNodes[0].innerHTML="";var m=
document.createElement("li");m.innerHTML=tinymce.util.I18n.translate("Loading...");b.container.childNodes[0].appendChild(m);b.container.style.display="block";var g=this.getWindowScrollOffset(window),s=a.dom.getPos(a.getContentAreaContainer()),n=this.getWindowScrollOffset(a.getWin()),q=a.dom.getPos(a.selection.getNode()),w=0,z=0,z=a.selection.getRng();z.expand&&z.expand("word");var v=null;0==z.getClientRects().length?z.parentElement&&z.getBoundingClientRect&&z.moveToPoint&&z.moveStart?(z.moveToElementText(z.parentElement()),
v=z.getBoundingClientRect(),v.left=v.right,v.left+=0==z.boundingLeft?v.right-v.left:0,z.moveToPoint(v.left,v.top),z.moveStart("character",-1),v=z.getClientRects()[0]):z.insertNode&&(w=a.getWin().document.createElement("span"),z.insertNode(w),v=a.dom.getPos(w),v={left:v.x,top:v.y,width:0,height:w.offsetHeight},w.parentNode.removeChild(w)):v=z.getClientRects()[0];v&&(!v.width&&!v.height&&v.right&&v.bottom)&&(v={width:v.right-v.left,height:v.bottom-v.top,left:v.left-s.x,top:v.top-s.y});v?(w=v.top+v.height,
z=v.left):(w=1.3*parseInt(a.dom.getStyle(a.selection.getNode(),"font-size",!0))+q.y,z=q.x);w+s.y>$(window).height()/2?(b.container.style.bottom=$("body").outerHeight()-(s.y+g.y+w-n.y)+v.height+"px",b.container.style.left=s.x+g.x+z-n.x+"px",b.container.style.top="auto"):(b.container.style.top=s.y+g.y+w-n.y+"px",b.container.style.left=s.x+g.x+z-n.x+"px",b.container.style.bottom="auto");b.lastSearchText=c;window.clearTimeout(b.searchHandle);var r=a.selection.getBookmark(2);b.searchHandle=window.setTimeout(function(){d.searchForMentions(c,
function(c,h){if(b.lastSearchText==c)if(b.selected=null,b.container.childNodes[0].innerHTML="",h&&0!=h.length){k=!0;f=c;for(var g=0;g<h.length;g++)m=document.createElement("li"),m.style.cursor="pointer",m.innerHTML=h[g].previewhtml,m.onclick=function(){a.selection.moveToBookmark(r);d.selectMentionable(a,d.getCurrentWord(a))},m.onmouseover=function(){d.setHighlightdMention(parseInt(a.dom.getAttrib(this,"data-index")))},a.dom.setAttrib(m,"data-index",g),a.dom.setAttrib(m,"data-contentid",h[g].contentid),
a.dom.setAttrib(m,"data-contenttypeid",h[g].contenttypeid),b.container.childNodes[0].appendChild(m),b.selected||(b.selectedIndex=g,b.selected=m,b.selected.className="mceMentionablesSelected")}else k&&(f=c.substr(0,c.length-1),k=!1),d.hideMentionables()})},249)};n.hideMentionables=function(a){b.container&&(b.container.style.display="none",b.selected=null,b.selectedIndex=-1);g=!1};n.getCurrentWord=function(a){var b=a.getDoc();a=a.selection.getSel();if(a.focusNode&&a.focusOffset){var b=a.focusNode.nodeValue,
d=a.focusOffset-1;if(null==b||0==b.length)return"";a=0;for(var c=d;0<=c;c--)if("@"==b.charAt(c)){a=c;break}b=b.substr(a,d+1-a);if(0<b.length&&"@"==b.charAt(0).toString())return b}else if(b.selection&&b.selection.createRange){a=b.selection.createRange();if(!(a.parentElement&&a.moveToPoint&&a.moveStart&&a.getBoundingClientRect))return"";if(null!=a.parentElement())try{a.parentElement().focus()}catch(f){}a=b.selection.createRange();b=a.getBoundingClientRect();0==b.left&&0==b.top&&(a.moveToElementText(a.parentElement()),
b=a.getBoundingClientRect(),b.left=b.right);b.left+=0==a.boundingLeft?b.right-b.left:0;b.top=(b.bottom+b.top)/2;a.moveToPoint(b.left,b.top);a.moveStart("word",-1);a.moveStart("character",-1);b=a.text;a=0;for(c=b.length-1;0<=c;c--)if("@"==b.charAt(c)){a=c;break}b=b.substr(a,b.length-a);if(0<b.length&&"@"==b.charAt(0).toString())return b}return""};n.selectMentionable=function(a,c){if(!(0>=c.length)&&b.selected){var d=a.selection.getRng();if(d.setStart)d.setStart(d.startContainer,d.startOffset-c.length);
else if(d.parentElement&&d.getBoundingClientRect&&d.moveToPoint&&d.moveStart){var f=d.getBoundingClientRect();0==f.left&&0==f.top&&(d.moveToElementText(d.parentElement()),f=d.getBoundingClientRect(),f.left=f.right,f.left+=0==d.boundingLeft?f.right-f.left:0,d.moveToPoint(f.left,f.top));d.moveStart("character",-1*c.length)}f={id:"mceMention"+(new Date).getTime(),contentId:a.dom.getAttrib(b.selected,"data-contentid"),contentTypeId:a.dom.getAttrib(b.selected,"data-contenttypeid")};a.selection.setRng(d);
d=(d=$(b.selected).find(".mentionable-suggestion-preview"))&&0<d.length?d.html():b.selected.innerHTML;a.selection.setContent('<span contenteditable="false" class="mceItem mceMention mceNonEditable" id="'+f.id+'" data-mce-json="'+s.serialize(f,"'")+'">'+d+"</span>");a.nodeChanged();this.hideMentionables()}};n.isMentionSpan=function(a){return a&&"SPAN"===a.nodeName&&this.editor.dom.hasClass(a,"mceMention")};n.spanToObject=function(a,b){var d,c;(d=a.attr("data-mce-json"))&&!a.isEmpty()&&(d=s.parse(d),
d.contentId&&d.contentTypeId&&(c=new q("#text",3),c.raw=!0,c.value="[mention:"+d.contentId+":"+d.contentTypeId+"]"));c?a.replace(c):a.remove()};n.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};n.textToSpan=function(a){var b=this,d=b.editor;if(a.parent){for(var c=new q("div"),f=/\[mention:([a-fA-F0-9]{32}):([a-fA-F0-9]{32})\]/g,k,g=0;k=f.exec(a.value);)(function(){var f={id:"mceMention"+
m,contentId:RegExp.$1,contentTypeId:RegExp.$2};if(0<k.index)for(var n=d.parser.parse(b.resolveWhitespace(a.value.substr(g,k.index-g))).getAll("p"),r=0;r<n.length;r++)for(var u;null!=(u=n[r].walk());)c.append(u);n=new q("span",1);c.append(n);n.attr({id:f.id,"class":"mceItem mceMention mceNonEditable","data-mce-json":s.serialize(f,"'"),contenteditable:"false"});r=new q("#text",3);r.raw=!0;r.value=tinymce.util.I18n.translate("???");n.append(r);b.getMentionPreview(f,function(a){var b=d.dom.get(f.id);
b&&(b.innerHTML=a)})})(),g=f.lastIndex,m++;if(0<g){if(g<a.value.length)for(var f=d.parser.parse(b.resolveWhitespace(a.value.substr(g))).getAll("p"),n=0;n<f.length;n++)for(var w;null!=(w=f[n].walk());)c.append(w);a.replace(c);c.unwrap()}}};n.getWindowScrollOffset=function(a){var b=0,d=0;"number"==typeof a.pageXOffset?(b=a.pageXOffset,d=a.pageYOffset):a.document.body&&(a.document.body.scrollLeft||a.document.body.scrollTop)?(b=a.document.body.scrollLeft,d=a.document.body.scrollTop):a.document.documentElement&&
(a.document.documentElement.scrollLeft||a.document.documentElement.scrollTop)&&(b=document.documentElement.scrollLeft,d=document.documentElement.scrollTop);return{x:b,y:d}};n.getMentionPreview=function(a,b){a.contentId&&a.contentTypeId?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p",contentid:a.contentId,contenttypeid:a.contentTypeId}),success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.html?b(a.html):b("")}catch(c){}},error:function(a){try{b("")}catch(c){}}}):b("")};n.searchForMentions=
function(a,b){tinymce.util.XHR.send({url:this.getCallbackUrl({t:"s",query:a}),success:function(d){d=tinymce.util.JSON.parse(d);try{d&&d.mentionables?b(a,d.mentionables):b(a,null)}catch(c){}},error:function(d){try{b(a,null)}catch(c){}}})};n.getCallbackUrl=function(a){for(var b=this.url+"../../../apis/mentions?",d={},c=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),f=0;f<c.length;f++){var k=c[f].split(/=/);2==k.length&&(d[k[0]]=k[1])}for(var g in a)d[encodeURIComponent(g)]=encodeURIComponent(a[g]);
a=!0;for(g in d)a?a=!1:b+="&",b+=g+"="+d[g];return b};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(a){for(var b=a.length;b--;)n.textToSpan(a[b])});c.serializer.addNodeFilter("span",function(a,b,d){b=a.length;for(var c;b--;)c=a[b],-1!==(c.attr("class")||"").indexOf("mceMention")&&n.spanToObject(c,d)});c.on("keydown",function(a){return n.handleKeyDown(c,a)},!0);c.on("keyup",function(a){return n.handleKeyUp(c,a)},!0);c.on("click",function(){n.hideMentionables()})});c.on("ResolveName",
function(a){"span"===a.name&&c.dom.hasClass(a.target,"mceMention")&&(a.name=tinymce.util.I18n.translate("mention"))});c.addMenuItem("removemention",{text:"Remove mention",cmd:"mceRemoveMention",stateSelector:"span.mceMention",context:"insert",prependToContext:!0,onPostRender:function(a){a.control.hide();c.on("NodeChange",function(){var b,d;b=c.dom.getParent(c.selection.getStart(),function(a){return c.dom.hasClass(a,"mceMention")});d=c.dom.getParent(c.selection.getEnd(),function(a){return c.dom.hasClass(a,
"mceMention")});b||d?a.control.show():a.control.hide()},!0)}});c.addCommand("mceRemoveMention",function(){var a,b;b=c.selection.getNode();n.isMentionSpan(b)&&(a=c.dom.getAttrib(b,"data-mce-json"))&&(a=s.parse(a));a&&c.dom.setOuterHTML(b,b.innerHTML)});c.addButton("mentionremove",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(a){return c.dom.is(a,"span.mceMention")&&c.getBody().contains(a)},"mentionremove")});tinymce.PluginManager.add("modalpopups",
function(c,t){var q=tinymce.ui.Panel.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",border:"0 0 0 0",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},modalElm:null,init:function(c){var g=this;g._super(c);g.isRtl()&&(g.classes=(g.classes||"")+" rtl");g._fixed=!1;c.buttons&&(g.statusbar=new tinymce.ui.Panel({layout:"flex",border:"0 0 0 0",spacing:3,padding:10,align:"center",pack:"start",defaults:{type:"button"},
items:c.buttons,classes:"foot"}),g.statusbar.parent(g));g.on("click",function(a){-1!=a.target.className.indexOf(g.classPrefix+"close")&&g.close()});g.on("cancel",function(){g.close()});g.aria("describedby",g.describedBy||g._id+"-none");g.aria("label",c.title);g._fullscreen=!1;g.modalElm=document.createElement("div");g.modalElm.style.visibility="hidden";$(document.getElementsByTagName("body")).append(g.modalElm);$(g.modalElm).html(g.renderHtml());g.postRender();g.reflow();window.setTimeout(function(){$(".mce-floatpanel.mce-arrow").hide();
g.modalElm.style.visibility="visible";g.modalElm=$.glowModal({html:g.modalElm,title:c.title,onClose:function(){g.modalIsClosed||(g.modalIsClosed=!0,g.close())}});c.onShown&&c.onShown.call(g)},1)},recalc:function(){var c=this.statusbar,g,a,k;this._fullscreen&&(this.layoutRect(tinymce.DOM.getWindowSize()),this.layoutRect().contentH=this.layoutRect().innerH);this._super();g=this.layoutRect();this.settings.title&&!this._fullscreen&&(a=g.headerW,a>g.w&&(k=g.x-Math.max(0,a/2),this.layoutRect({w:a,x:k}),
k=!0));c&&(c.layoutRect({w:this.layoutRect().innerW}).recalc(),a=c.layoutRect().minW+g.deltaW,a>g.w&&(k=g.x-Math.max(0,a-g.w),this.layoutRect({w:a,x:k}),k=!0));k&&this.recalc();$.glowModal.refresh()},initLayoutRect:function(){var c=this._super(),g=0;this.statusbar&&(g+=this.statusbar.layoutRect().h);c.deltaH+=g;c.minH+=g;c.h+=g;c.x=1;c.y=1;return c},close:function(){this.fire("close").isDefaultPrevented()||(this.remove(),this.modalIsClosed||$.glowModal.close(),$.glowModal.defaults.openInParentModal=
this._openInParentModal);return this},renderHtml:function(){var c=this._layout,g=this._id,a=this.settings,k="",f=a.html;this.preRender();c.preRender(this);a.url&&(f='<iframe src="'+a.url+'" tabindex="-1"></iframe>');"undefined"==typeof f&&(f=c.renderHtml(this));this.statusbar&&(k=this.statusbar.renderHtml());return'<div id="'+g+'" class="'+this.classes+'" hidefocus="1"><div class="'+this.classPrefix+'reset" role="application"><div id="'+g+'-body" class="'+this.bodyClasses+'">'+f+"</div>"+k+"</div></div>"},
fullscreen:function(c){},resizeTo:function(){},resizeBy:function(){},resizeToContent:function(){},hide:function(){},hideAll:function(){},postRender:function(){var c=this;setTimeout(function(){c.classes=(c.classes||"")+" in"},0);c._super();c.statusbar&&c.statusbar.postRender();c.focus();c.on("submit",function(g){g.isDefaultPrevented()||c.close()})},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){this._super();this.statusbar&&this.statusbar.remove()},getContainerElm:function(){return this.modalElm},
getContentWindow:function(){var c=this.getEl().getElementsByTagName("iframe")[0];return c?c.contentWindow:null}});c.windowManager=new function(c){function g(){if(a.windows.length)return a.windows[a.windows.length-1]}var a=this;a.windows=[];c.on("remove",function(){for(;0<a.windows.length;)$.glowModal.close(),a.windows.pop()});$(window).on("scroll",function(){var a=g();if(a)try{$(a.modalElm).click()}catch(c){}});a.open=function(k,f){var b;c.editorManager.setActive(c);k.title=k.title||" ";k.url=k.url||
k.file;k.url&&(k.width=parseInt(k.width||320,10),k.height=parseInt(k.height||240,10));k.body&&(k.items={defaults:k.defaults,type:k.bodyType||"form",items:k.body});k.url||k.buttons||(k.buttons=[{text:"Ok",subtype:"primary",onclick:function(){b.find("form")[0].submit()}},{text:"Cancel",onclick:function(){b.close()}}]);var g=$.glowModal.defaults.openInParentModal;$.glowModal.defaults.openInParentModal=!1;b=new q(k);b._openInParentModal=g;b.modalIsClosed=!1;a.windows.push(b);b.on("close",function(){for(var f=
a.windows.length;f--;)a.windows[f]===b&&a.windows.splice(f,1);a.windows.length||c.focus()});if(k.data)b.on("postRender",function(){this.find("*").each(function(a){var b=a.name();b in k.data&&a.value(k.data[b])})});b.features=k||{};b.params=f||{};1===a.windows.length&&c.nodeChanged();return b};a.alert=function(a,f,b){window.alert(c.translate(a));f?f.call(b||this):c.focus()};a.confirm=function(a,f,b){f.call(b||this,window.confirm(c.translate(a)))};a.close=function(){g()&&g().close()};a.getParams=function(){return g()?
g().params:null};a.setParams=function(a){g()&&(g().params=a)};a.getWindows=function(){return windows}}(c)});tinymce.PluginManager.add("preview",function(c,t){function q(g){var a="";tinymce.util.XHR.send({url:s({t:"p",ct:c.settings.evolution_contenttypeid||""}),data:"html="+encodeURIComponent(g)+"&baseUrl="+encodeURIComponent(c.documentBaseURI.getURI()),content_type:"application/x-www-form-urlencoded",async:!1,success:function(c){c=tinymce.util.JSON.parse(c);try{c&&(c.preview?a=c.preview:c.error&&
jQuery.telligent.evolution.notifications.show(c.error,{type:"error"}))}catch(f){}},error:function(a){}});return a}function s(c){for(var a=t+"../../../apis/preview?",k={},f=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),b=0;b<f.length;b++){var m=f[b].split(/=/);2==m.length&&(k[m[0]]=m[1])}for(var n in c)k[encodeURIComponent(n)]=encodeURIComponent(c[n]);c=!0;for(n in k)c?c=!1:a+="&",a+=n+"="+k[n];return a}c.addCommand("mcePreview",function(){var g=c.windowManager.open({title:tinymce.util.I18n.translate("Preview"),
width:640,height:500,html:'<iframe src="about:blank" style="height: 500px; width:100%;" class="mcetelligent-frame with-border"></iframe>',buttons:{text:"Close",onclick:function(){g.close()}},onShown:function(){var a=this.getEl("body").firstChild.contentWindow.document;a.open();a.write(q(c.getContent()));a.close()}})});c.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",icon:"preview",context:"tools"})});tinymce.PluginManager.add("quotes",function(c,t){var q=tinymce.html.Node,s=tinymce.util.JSON,
g=0,a=this;a.editor=c;a.url=t;a.getInfo=function(){return{longname:"Insert Quote",author:"Telligent",authorurl:"http://telligent.com",version:"6.5"}};a.dataToDiv=function(a,c){var b=this.editor,g;g=this.editor.dom.create("div",{id:a.id,"class":"mceItem mceNonEditable mceQuote","data-mce-json":s.serialize(a,"'"),contenteditable:"false"});g.innerHTML="...";this.getPreview(a,function(c){var f=b.dom.get(a.id);f&&(f.innerHTML=c)});return g};a.dataToHtml=function(a,c){return this.editor.serializer.serialize(this.dataToDiv(a,
c),{forced_root_block:"",force_absolute:c})};a.htmlToData=function(a){var c;c={};(a=this.editor.parser.parse(a).getAll("div")[0])&&(c=s.parse(a.attr("data-mce-json")));return c};a.divToObject=function(a,c){var b,g;if(b=a.attr("data-mce-json"))b=s.parse(b),b.code&&(g=new q("#text",3),g.raw=!0,g.value=decodeURIComponent(b.code)),g?a.replace(g):a.remove()};a.processQuotesInHtml=function(a,c){for(var b=/(\[quote[^\]]*\].*?\[\/quote\])/gi,m=0,n,l=[];n=b.exec(a);){var h=encodeURIComponent(RegExp.$1),h=
{id:"mceQuote"+g++,code:h};0<n.index&&l.push(a.substr(m,n.index-m));c?l.push('<span id="'+h.id+'" class="mceItem mceNonEditable mceQuote" contenteditable="false" data-mce-json="'+$.telligent.evolution.html.encode(s.serialize(h,"'"))+'">...</span>'):l.push('<div id="'+h.id+'" class="mceItem mceNonEditable mceQuote" contenteditable="false" data-mce-json="'+$.telligent.evolution.html.encode(s.serialize(h,"'"))+'">...</div>');m=b.lastIndex}m<a.length&&l.push(a.substr(m));return l.join("")};a.getCallbackUrl=
function(a){for(var c=this.url+"../../../apis/quotes?",b={},g=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),n=0;n<g.length;n++){var l=g[n].split(/=/);2==l.length&&(b[l[0]]=l[1])}for(var h in a)b[encodeURIComponent(h)]=encodeURIComponent(a[h]);a=!0;for(h in b)a?a=!1:c+="&",c+=h+"="+b[h];return c};a.getPreview=function(a,c){a.code&&0!=a.code.length?tinymce.util.XHR.send({url:this.getCallbackUrl({t:"p"}),data:"bb="+a.code,content_type:"application/x-www-form-urlencoded",success:function(b){b=
tinymce.util.JSON.parse(b);try{b&&b.html?c(b.html):c(decodeURIComponent(a.code))}catch(g){}},error:function(b){try{c(decodeURIComponent(a.code))}catch(g){}}}):c("")};c.on("PreInit",function(){c.on("BeforeSetContent",function(c){c.content=a.processQuotesInHtml(c.content,c.selection)});c.parser.addNodeFilter("span",function(k){for(var f=k.length;f--;)(function(b){if(-1!==(b.attr("class")||"").indexOf("mceQuote")){var f=b.attr("data-mce-json");f&&(f=s.parse(f),f.code&&window.setTimeout(function(){var b=
c.dom.get(f.id),k;if(b){k=document.createElement("div");$(k).attr({id:f.id,"data-mce-json":s.serialize(f,"'"),contenteditable:"false"}).addClass("mceItem mceQuote mceNonEditable").html("...");if(b.parentNode&&"P"==b.parentNode.nodeName){var h=$.trim(b.parentNode.textContent||"");0!=h.length&&"..."!=h||1!=b.parentNode.children.length?($(b.parentNode).after(k),c.dom.remove(b)):c.dom.replace(k,b.parentNode,!1);$(k).after("<p><br/></p>")}else c.dom.replace(k,b,!1);a.getPreview(f,function(a){var b=c.dom.get(f.id);
b&&(b.innerHTML=a)})}},1))}})(k[f])});c.parser.addNodeFilter("div",function(k){for(var f=k.length;f--;)(function(b){if(-1!==(b.attr("class")||"").indexOf("mceQuote")){var f=b.attr("data-mce-json");f&&(f=s.parse(f),f.code&&a.getPreview(f,function(a){var b=c.dom.get(f.id);b&&(b.innerHTML=a)}))}})(k[f])});c.serializer.addNodeFilter("div",function(c,f,b){f=c.length;for(var g;f--;)g=c[f],-1!==(g.attr("class")||"").indexOf("mceQuote")&&a.divToObject(g,b)})});c.on("ResolveName",function(a){"div"===a.name&&
c.dom.hasClass(a.target,"mceQuote")&&(a.name=tinymce.util.I18n.translate("Blockquote"))});c.addButton("removequote",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});c.addContextToolbar(function(a){return c.dom.hasClass(a,"mceQuote")},"removequote")});tinymce.PluginManager.add("source",function(c){function t(){var q=c.windowManager.open({title:"Source code",body:{type:"textbox",name:"code",multiline:!0,minWidth:c.getParam("code_dialog_width",600),minHeight:c.getParam("code_dialog_height",
Math.min(tinymce.DOM.getViewPort().h-200,500)),spellcheck:!1,style:"direction: ltr; text-align: left"},onSubmit:function(s){c.focus();c.undoManager.transact(function(){c.setContent(s.data.code)});c.selection.setCursorLocation();c.nodeChanged()}});q.find("#code").value(c.getContent({source_view:!0}));jQuery&&jQuery(q.find("#code")[0].getEl()).evolutionCodeEditor({mode:"html"})}c.addCommand("mceSourceEditor",t);c.addButton("source",{icon:"code",tooltip:"Source code",onclick:t});c.addMenuItem("source",
{icon:"code",text:"Source code",context:"tools",onclick:t})});tinymce.PluginManager.add("submit",function(c,t){var q=function(c){c.preventDefault();c.stopImmediatePropagation();c.stopPropagation();return!1};tinymce.ui.SubmitPanel=tinymce.ui.PanelButton.extend({init:function(c){this._super(c);this.classes.add("submitpanel");this.classes.remove("btn")},renderHtml:function(){var c=this._id,g=[];g.push('<div id="'+c+'" class="'+this.classes+'" tabindex="0" role="presentation" aria-haspopup="false">');
this.settings.editor.settings.submit_enabletoggle&&(g.push('<div id="'+c+'_enable_wrapper" class="mce-submitpanel-message">'),g.push('<input id="'+c+'_enable" type="checkbox" role="presentation" tabindex="-1" />'),g.push('<label for="'+c+'_enable" tabindex="-1" role="presentation">'+(this.settings.editor.settings.submit_entermessage||"Press enter to send")+"</label>"),g.push("</div>"));g.push('<div class="mce-widget mce-btn mce-primary mce-btn-has-text mce-submitpanel-button" tabindex="-1" id="'+
c+'_send" role="button"><button tabindex="-1" style="width:100%; height:100%;" type="button"><span class="mce-txt">');g.push(this.settings.editor.settings.submit_buttontext||"Send");g.push("</span></button></div>");g.push("</div>");return g.join("")},focus:function(){try{var c=$(this.id+"_send",this.getEl());if(0<c.length)return c.focus(),this;var g=$(this.id+"_enable_wrapper",this.getEl());if(0<g.length)return g.focus(),this}catch(a){}return this},postRender:function(){function c(){var a=!1;f.is(":checked")?
(k.css("display","none"),a=!0):(k.css("display","inline-block"),a=!1);null!=window.localStorage&&window.localStorage.setItem("tinymce-entertosubmit",a.toString())}function g(a,b){for(var c=0;c<b.length;c++)if(a.nodeName==b[c])return!0;return a.parentNode?g(a.parentNode,b):!1}var a=this,k,f,b,m;m=0;b=$("#"+a._id);k=$("#"+a._id+"_send");f=$("#"+a._id+"_enable");cbx_wrapper=$("#"+a._id+"_enable_wrapper");b.closest(".mce-btn-group").css("width","100%").children("div").css("white-space","normal");var n=
window["_submit_"+a.settings.editor.id]||null,l,h;n?(l=n.prehtml,h=n.posthtml):(n={},(l=a.settings.editor.settings.submittable_prehtml)&&(l=$(l)),(h=a.settings.editor.settings.submittable_posthtml)&&(h=$(h)),n.prehtml=l,n.posthtml=h,window["_submit_"+a.settings.editor.id]=n);l&&b.prepend(l);h&&b.append(h);a.settings.editor.settings.submit_enabletoggle&&(b=a.settings.editor.settings.submit_entertosubmit,null!=window.localStorage&&null!==window.localStorage.getItem("tinymce-entertosubmit")&&(b="true"==
window.localStorage.getItem("tinymce-entertosubmit")),b?(f.removeClass("mce-submitpanel-unchecked").addClass("mce-submitpanel-checked"),f.attr("checked",!0)):f.removeClass("mce-submitpanel-checked").addClass("mce-submitpanel-unchecked"),a.settings.editor.on("keydown",function(b){if(13==b.keyCode&&f.is(":checked")&&!(b.shiftKey||b.altKey||b.metaKey||b.ctrlKey)){var c=(new Date).getTime(),k=a.settings.editor.selection.getNode();if(g(k,["UL","OL","DL"]))m=c;else if(2E3<c-m)return a.settings.editor.settings.submit_onsubmit&&
a.settings.editor.settings.submit_onsubmit(a.settings.editor),q(b)}},!0),f.on("change",function(a){c()}),c());k.on("click",function(b){a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor);return q(b)}).on("keydown",function(b){if(13==b.keyCode&&!(b.shiftKey||b.altKey||b.metaKey||b.ctrlKey))return a.settings.editor.settings.submit_onsubmit&&a.settings.editor.settings.submit_onsubmit(a.settings.editor),q(b)})}});c.on("Init",function(){var q=$(c.getContainer()),
g=function(){470<q.width()?q.removeClass("mce-submitpanel-narrow"):q.addClass("mce-submitpanel-narrow")};q.on("resized",function(){g()});g()});c.addButton("submit",{type:"SubmitPanel",editor:c})});tinymce.PluginManager.add("tinyautosave",function(c,t){function q(){var a=x[this.key];a.timer&&window.clearInterval(a.timer);tinymce.dom.Event.remove(window,"unload",a.saveFinalDelegate);this.editor.onRemove.remove(a.saveFinalDelegate);delete x[this.key]}function s(a){if(!a)return!0;var b,c;b=tinymce.is;
if(b(a,"string"))(b=A[a])?c=b[a]:A[a]=c=tinymce.resolve(a);else if(b(a,"function"))c=a;else return!0;return c.apply(this)}function g(){var a=x[this.key];a.saveDelegate();a.disposeDelegate()}function a(){var a=!1;try{var f=x[this.key],k=tinymce.is,g=new Date,m,n,p,q;if(this.editor&&!f.busy){f.busy=!0;m=c.getContent();if(k(m,"string")&&m.length>=f.minSaveLength){if(!s.call(this,this.onPreSave))return f.busy=!1;n=new Date(g.getTime()+6E4*f.retentionMinutes);try{l?localStorage.setItem(f.dataKey,n.toString()+
","+m.replace(/,/g,"&#44;")):h?sessionStorage.setItem(f.dataKey,n.toString()+","+m.replace(/,/g,"&#44;")):d?(y.setAttribute(x[this.key].dataKey,m),y.expires=n.toUTCString(),y.save("TinyMCE")):(p=f.dataKey+"=",q="; expires="+n.toUTCString(),document.cookie=p+b(m).slice(0,4096-p.length-q.length)+q),a=!0}catch(r){s.call(this,this.onSaveError)}a&&(f.canRestore=!0,s.call(this,this.onPostSave))}f.busy=!1}}catch(u){}return a}function k(){var a=x[this.key],b=null,k=tinymce.is,g,n;if(this.editor&&a.canRestore&&
!a.busy){a.busy=!0;if(s.call(this,this.onPreRestore))try{l||h?(b=((l?localStorage.getItem(a.dataKey):sessionStorage.getItem(a.dataKey))||"").toString(),g=b.indexOf(","),b=-1==g?null:b.slice(g+1,b.length).replace(/&#44;/g,",")):d?b=f(this):(n=a.cookieFilter.exec(document.cookie))&&(b=m(n[1])),k(b,"string")?(c.getContent().replace(/\s|&nbsp;|<\/?p[^>]*>|<br[^>]*>/gi,""),c.setContent(b),s.call(this,this.onPostRestore)):c.windowManager.alert(tinymce.util.I18n.translate("No content was available to restore."))}catch(p){s.call(this,
this.onRestoreError)}a.busy=!1}}function f(a){y.load("TinyMCE");return y.getAttribute(x[a.key].dataKey)}function b(a){return a.replace(/[\x00-\x1f]+|&nbsp;|&#160;/gi," ").replace(/(.)\1{5,}|[%&;=<]/g,function(a){return 1<a.length?"%0"+a.charAt(0)+a.length.toString()+"%":p[a]})}function m(a){return a.replace(/%[1-5]|%0(.)(\d+)%/g,function(a,b,c){var d;if(2==a.length)return u[a];a=[];d=0;for(c=parseInt(c);d<c;d++)a.push(b);return a.join("")})}function n(a,b){return function(){return b.apply(a)}}var l=
!1,h=!1,d=!1,p={"%":"%1","&":"%2",";":"%3","=":"%4","<":"%5"},u={"%1":"%","%2":"&","%3":";","%4":"=","%5":"<"},x={},A={},y=null,w={dataKey:"TinyAutoSave",cookieFilter:null,saveDelegate:null,saveFinalDelegate:null,restoreDelegate:null,disposeDelegate:null,intervalSeconds:60,retentionMinutes:20,minSaveLength:50,canRestore:!1,busy:!1,timer:null};try{localStorage.setItem("TinyAutoSave_Test_","OK"),"OK"===localStorage.getItem("TinyAutoSave_Test_")&&(localStorage.removeItem("TinyAutoSave_Test_"),l=!0)}catch(z){try{sessionStorage.setItem("TinyAutoSave_Test_",
"OK"),"OK"===sessionStorage.getItem("TinyAutoSave_Test_")&&(sessionStorage.removeItem("TinyAutoSave_Test_"),h=!0)}catch(v){d=tinymce.isIE}}var r=this,F=tinymce.is,G=tinymce.resolve,C,D,E;r.editor=c;r.id=c.id;r.url=t;r.key=c.getParam("tinyautosave_key",c.id);C=function(b){var c=b.key,d=x[c];d||(d=x[c]=tinymce.extend({},w,{dataKey:w.dataKey+c,saveDelegate:n(b,a),saveFinalDelegate:n(b,g),restoreDelegate:n(b,k),disposeDelegate:n(b,q),cookieFilter:RegExp("(?:^|;\\s*)"+w.dataKey+c+"=([^;]*)(?:;|$)","i")}));
return d}(r);C.intervalSeconds=Math.max(1,parseInt(c.getParam("tinyautosave_interval_seconds",null)||c.getParam("tinyautosave_interval",C.intervalSeconds)));C.retentionMinutes=Math.max(1,parseInt(c.getParam("tinyautosave_retention_minutes",null)||c.getParam("tinyautosave_retention",C.retentionMinutes)));C.minSaveLength=Math.max(1,parseInt(c.getParam("tinyautosave_minlength",C.minSaveLength)));C.saveDelegate=n(r,a);C.saveFinalDelegate=n(r,g);C.restoreDelegate=n(r,k);c.addCommand("mceTinyAutoSave",
C.saveDelegate);c.addCommand("mceTinyAutoSaveRestore",C.restoreDelegate);c.addMenuItem("tinyautosave",{text:"Restore lost content",icon:"restoredraft",cmd:"mceTinyAutoSaveRestore",context:"tools",prependToContext:!0,onPostRender:function(a){window.setInterval(function(){r.hasSavedContent()?a.control.show():a.control.hide()},250)}});C.timer=window.setInterval(C.saveDelegate,1E3*C.intervalSeconds);c.on("init",function(){d&&(y||(y=c.getElement()),y.style.behavior="url('#default#userData')");C.canRestore=
r.hasSavedContent();D=c.getParam("tinyautosave_oninit",null);F(D,"string")&&(E=G(D),F(E,"function")&&E.apply(r))});r.getInfo=function(){return{longname:"TinyAutoSave",author:"Speednet",authorurl:"http://www.speednet.biz/",infourl:"http://tinyautosave.googlecode.com/",version:"2.1.3"}};r.clear=function(){var a=x[this.key];l?localStorage.removeItem(a.dataKey):h?sessionStorage.removeItem(a.dataKey):d?y.removeAttribute(x[this.key].dataKey):tinymce.util.Cookie.remove(a.dataKey);a.canRestore=!1};r.hasSavedContent=
function(){var a=x[this.key],b=new Date,c,k;try{if(l||h){c=((l?localStorage.getItem(a.dataKey):sessionStorage.getItem(a.dataKey))||"").toString();k=c.indexOf(",");if(8<k&&k<c.length-1){if(new Date(c.slice(0,k))>b)return!0;l?localStorage.removeItem(a.dataKey):sessionStorage.removeItem(a.dataKey)}return!1}return d?0<(f(this)||"").length:0<(tinymce.util.Cookie.get(a.dataKey)||"").length}catch(g){return!1}}});tinymce.PluginManager.add("tips",function(c,t){var q=null,s=[],g=null,a=this;a.isDefaultNode=
function(a){return null==a||"P"==a.nodeName||"BR"==a.nodeName||"BODY"==a.nodeName};a.getRandomDefaultTip=function(){return 0==s.length?"":1==s.length?s[0]:s[Math.round(Math.random()*(s.length-1))]};a.updateTip=function(a,c){c&&(g=c);q&&q.text(a)};c.addCommand("mceTip",function(k,f){a.updateTip(f,c.selection.getNode()||"unknown");return!0});c.on("NodeChange",function(){var k=c.selection.getNode()||{nodeName:"P"};g&&g!=k&&(a.isDefaultNode(k)?a.updateTip(a.getRandomDefaultTip(),k):a.updateTip("",k))},
!0);c.on("init",function(){q=jQuery('<div class="mce-first mce-flow-layout-item"></div>').css({padding:"8px",color:"rgba(0,0,0,.33)"});jQuery(".mce-container-body .mce-path",c.getContainer()).before(q);var k=c.selection.getNode()||{nodeName:"P"};a.isDefaultNode(k)&&a.updateTip(a.getRandomDefaultTip(),k)});return{defaultTip:function(k){s.push(k);k=c.selection.getNode()||{nodeName:"P"};a.isDefaultNode(k)&&a.updateTip(a.getRandomDefaultTip(),k)}}});tinymce.PluginManager.add("tokens",function(c,t){var q=
tinymce.html.Node,s=tinymce.util.JSON,g=0,a=this;a.editor=c;a.url=t;a.isToken=function(a){var c=this;if(!a)return!1;if(c.editor.dom.hasClass(a,"mceTokenItem"))return a;a=c.editor.dom.getParent(a,function(a){return c.editor.dom.hasClass(a,"mceTokenItem")});return null!=a?a:!1};a.openDialog=function(){function a(){var c=$(y.getEl());$(".mce-primary button",c).attr("disabled","disabled");E=new tinymce.Editor(v,$.extend({},A.editor.settings,{selector:null,width:600,height:330,resize:!1}),tinymce.EditorManager);
E.render();D=A.getTokens(G);var f=$(".mcetoken-token",c);$.each(D,function(){var a=$('<option value="'+this.id.toLowerCase()+'"></option>');a.text(this.name);a.data("token",this);f.append(a)});f.on("change",function(){n()});$(".mcetoken-linkurltarget, .mcetoken-imageurlwidth, .mcetoken-imageurlheight, .mcetoken-truncateat, .mcetoken-conditionvalue, .mcetoken-maxcount",c).on("change",function(){g()});$(".mcetoken-imageurlwidth, .mcetoken-imageurlheight, .mcetoken-truncateat, .mcetoken-conditionvalue, .mcetoken-maxcount",
c).on("keyup",function(){g()});$(".mcetoken-truncate",c).on("change",function(){p()});$(".mcetoken-condition",c).on("change",function(){l()});$(".mcetoken-conditiontemplate",c).on("change",function(){h()});$(".mcetoken-template",c).on("change",function(){d()});b(!0)}function c(a){var b={};a=(a||"").split(/&/g);for(var d=0;d<a.length;d++){var f=a[d].split("=");2==f.length&&(b[decodeURIComponent(f[0])]=decodeURIComponent(f[1]).replace(/\+/g," "))}return b}function b(a,b){var h=$(y.getEl());if(a){if(x.tokenId){t=
null;for(var k=0;k<D.length&&!t;k++)D[k].id.toLowerCase()==x.tokenId.toLowerCase()&&(t=D[k]);if(t){$(".mcetoken-token",h).val(t.id.toLowerCase());n();k=c(x.configuration);if("container"==t.type)k["max-characters"]&&(r["after-truncation-template"]=k["after-truncation-template"]||"",$(".mcetoken-truncate",h).val("maxlength"),$(".mcetoken-truncateat",h).val(k["max-characters"]),p()),r["sub-template"]=k["sub-template"]||"";else if("enumerable"==t.type)$(".mcetoken-maxcount",h).val(k["max-count"]||"10"),
r["item-template"]=k["item-template"]||"",r["empty-template"]=k["empty-template"]||"",r["before-template"]=k["before-template"]||"",r["after-template"]=k["after-template"]||"";else if("linkurl"==t.type){var g=c(k["tag-attributes"]);"_blank"==g.target&&$(".mcetoken-linkurltarget",h).val("_blank");r["title-template"]=k["title-template"]||"";r["internal-template"]=k["internal-template"]||""}else"imageurl"==t.type?(g=c(k["tag-attributes"]),$(".mcetoken-imageurlwidth",h).val(g.width||""),$(".mcetoken-imageurlheight",
h).val(g.height||""),r["title-template"]=k["title-template"]||""):(k["max-characters"]&&(r["after-truncation-template"]=k["after-truncation-template"]||"",$(".mcetoken-truncate",h).val("maxlength"),$(".mcetoken-truncateat",h).val(k["max-characters"]),p()),k["comparison-type"]&&($(".mcetoken-condition",h).val(k["comparison-type"]),g=k["comparison-value"]||"",/\$\{[^\}]+\}/.test(g)?($(".mcetoken-conditiontemplate",h).val("template"),$(".mcetoken-conditionvalue",h).val(""),r["comparison-value"]=g):($(".mcetoken-conditiontemplate",
h).val("simple"),$(".mcetoken-conditionvalue",h).val(g)),r["true-template"]=k["true-template"]||"",r["false-template"]=k["false-template"]||"",l()));d(!1)}}t||n()}else if(t){x.tokenId=t.id;k={};d();if("container"==t.type)"maxlength"==$(".mcetoken-truncate",h).val()&&(k["max-characters"]=parseInt($(".mcetoken-truncateat",h).val(),10),k["after-truncation-template"]=r["after-truncation-template"]||""),k["sub-template"]=r["sub-template"]||"";else if("enumerable"==t.type)k["max-count"]=parseInt($(".mcetoken-maxcount",
h).val(),10),k["item-template"]=r["item-template"]||"",k["empty-template"]=r["empty-template"]||"",k["before-template"]=r["before-template"]||"",k["after-template"]=r["after-template"]||"";else if("linkurl"==t.type)g={},"_blank"==$(".mcetoken-linkurltarget",h).val()&&(g.target="_blank"),k["tag-attributes"]=$.param(g),k["title-template"]=r["title-template"]||"",k["internal-template"]=r["internal-template"]||"";else if("imageurl"==t.type){var g={},m=parseInt($(".mcetoken-imageurlwidth",h).val(),10);
isNaN(m)||(g.width=m);m=parseInt($(".mcetoken-imageurlheight",h).val(),10);isNaN(m)||(g.height=m);k["tag-attributes"]=$.param(g);k["title-template"]=r["title-template"]||""}else"maxlength"==$(".mcetoken-truncate",h).val()&&(k["max-characters"]=parseInt($(".mcetoken-truncateat",h).val(),10),k["after-truncation-template"]=r["after-truncation-template"]||""),""!=$(".mcetoken-condition",h).val()&&(k["comparison-type"]=$(".mcetoken-condition",h).val(),"simple"==$(".mcetoken-conditiontemplate",h).val()?
k["comparison-value"]=$(".mcetoken-conditionvalue",h).val():k["comparison-value"]=r["comparison-value"]||"",k["true-template"]=r["true-template"]||"",k["false-template"]=r["false-template"]||"");x.configuration=$.param(k)}else x.tokenId=null,x.configuration=null}function g(){var a=$(y.getEl()),b=!0;"maxlength"==$(".mcetoken-truncate",a).val()&&(isNaN(parseInt($(".mcetoken-truncateat",a).val(),10))||1>parseInt($(".mcetoken-truncateat",a).val(),10))&&(b=!1);null!=t&&"enumerable"==t.type&&(isNaN(parseInt($(".mcetoken-maxcount",
a).val(),10))||1>parseInt($(".mcetoken-maxcount",a).val(),10))&&(b=!1);null!=t&&"imageurl"==t.type&&(0<$(".mcetoken-imageurlwidth",a).val().length&&(isNaN(parseInt($(".mcetoken-imageurlwidth",a).val(),10))||0>parseInt($(".mcetoken-imageurlwidth",a).val(),10))&&(b=!1),0<$(".mcetoken-imageurlheight",a).val().length&&(isNaN(parseInt($(".mcetoken-imageurlheight",a).val(),10))||0>parseInt($(".mcetoken-imageurlheight",a).val(),10))&&(b=!1));b?$(".mce-primary button",a).removeAttr("disabled"):$(".mce-primary button",
a).attr("disabled","disabled")}function n(){var a=$(y.getEl());r={};x.tokenId=$(".mcetoken-token",a).val();if(x.tokenId){t=null;for(var b=0;b<D.length&&!t;b++)D[b].id.toLowerCase()==x.tokenId.toLowerCase()&&(t=D[b])}else t=null;t?"container"==t.type?(b=$(".mcetoken-template",a),b.html(""),b.append($('<option value="sub-template">'+tinymce.util.I18n.translate("Content")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",
a).show(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-truncate",a).val(""),d(!1)):"enumerable"==t.type?(b=$(".mcetoken-template",a),b.html(""),b.append($('<option value="item-template">'+tinymce.util.I18n.translate("Each item")+"</option>")),b.append($('<option value="empty-template">'+tinymce.util.I18n.translate("No items")+"</option>")),b.append($('<option value="before-template">'+tinymce.util.I18n.translate("Before all items")+
"</option>")),b.append($('<option value="after-template">'+tinymce.util.I18n.translate("After all items")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-maxcountcontainer",a).show(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-maxcount",a).val("10"),$(".mcetoken-truncate",a).val(""),d(!1)):"linkurl"==t.type?(b=$(".mcetoken-template",
a),b.html(""),b.append($('<option value="internal-template">'+tinymce.util.I18n.translate("Content")+"</option>")),b.append($('<option value="title-template">'+tinymce.util.I18n.translate("Title text")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).show(),$(".mcetoken-linkurltarget",
a).val(""),d(!1)):"imageurl"==t.type?(b=$(".mcetoken-template",a),b.html(""),b.append($('<option value="title-template">'+tinymce.util.I18n.translate("Title text")+"</option>")),$(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).show(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).show(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-imageurlwidth",a).val(""),$(".mcetoken-imageurlheight",
a).val(""),d(!1)):(b=$(".mcetoken-template",a),b.html(""),$(".mcetoken-conditioncontainer",a).show(),$(".mcetoken-condition",a).val(""),$(".mcetoken-conditionvalue",a).hide(),$(".mcetoken-conditionvalue",a).val(""),$(".mcetoken-conditiontemplate",a).val("simple"),$(".mcetoken-conditiontemplate",a).hide(),$(".mcetoken-templatecontainer",a).hide(),$(".mcetoken-truncationcontainer",a).show(),$(".mcetoken-maxcountcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",
a).hide(),$(".mcetoken-truncate",a).val("")):($(".mcetoken-conditioncontainer",a).hide(),$(".mcetoken-templatecontainer",a).hide(),$(".mcetoken-truncationcontainer",a).hide(),$(".mcetoken-imageurlsizecontainer",a).hide(),$(".mcetoken-linkurltargetcontainer",a).hide(),$(".mcetoken-truncate",a).val(""));g();q()}function l(){var a=$(y.getEl());if($(".mcetoken-condition",a).val()){var b=$(".mcetoken-template",a);$('.mcetoken-template option[value="true-template"]',a).remove();$('.mcetoken-template option[value="false-template"]',
a).remove();b.append($('<option value="true-template">'+tinymce.util.I18n.translate("Vary condition is true")+"</option>"));b.append($('<option value="false-template">'+tinymce.util.I18n.translate("Vary condition is false")+"</option>"));2==$(".mcetoken-template option",a).length?($(".mcetoken-templatecontainer",a).show(),d(!1)):d();$(".mcetoken-conditiontemplate",a).show();h()}else $('.mcetoken-template option[value="true-template"]',a).remove(),$('.mcetoken-template option[value="false-template"]',
a).remove(),0==$(".mcetoken-template option",a).length?$(".mcetoken-templatecontainer",a).hide():d(),$(".mcetoken-conditiontemplate",a).hide(),$(".mcetoken-conditionvalue",a).hide();g();q()}function h(){var a=$(y.getEl());"simple"==$(".mcetoken-conditiontemplate",a).val()?($('.mcetoken-template option[value="comparison-value"]',a).remove(),$(".mcetoken-conditionvalue").show(),0==$(".mcetoken-template option",a).length?$(".mcetoken-templatecontainer").hide():d()):($('.mcetoken-template option[value="comparison-value"]',
a).remove(),$(".mcetoken-conditionvalue",a).hide(),$(".mcetoken-template",a).append($('<option value="comparison-value">'+tinymce.util.I18n.translate("Condition comparison value")+"</option>")),1==$(".mcetoken-template option",a).length?($(".mcetoken-templatecontainer",a).show(),d(!1)):d());q()}function d(a){var b=$(y.getEl());if(!1!==a&&C)try{var c=E.getContent();if(result=/^<p>((?:(?!<p(?: |>)).)*)<\/p>$/.exec(c))c=RegExp.$1;r[C]=c}catch(f){}C=$(".mcetoken-template",b).val();a=$.merge([],G);if(("item-template"==
C||"after-truncation-template"==C||"sub-template"==C)&&t&&t.dataTypeIds&&0<t.dataTypeIds.length)for(b=0;b<t.dataTypeIds.length;b++){for(var c=!1,k=0;k<a.length&&!c;k++)a[k].toLowerCase()==t.dataTypeIds[b].toLowerCase()&&(c=!0);c||a.push(t.dataTypeIds[b])}E.settings.tokenDataTypeIds=a;a="";r[C]&&(a=r[C]);b=!1;try{E.setContent(a),""!=a&&""==E.getContent()&&(b=!0)}catch(h){b=!0}b&&window.setTimeout(function(){d(!1)},199);g()}function p(){var a=$(y.getEl());"maxlength"==$(".mcetoken-truncate",a).val()?
($(".mcetoken-truncationlengthcontainer",a).show(),$(".mcetoken-template",a).append($('<option value="after-truncation-template">'+tinymce.util.I18n.translate("After length limited")+"</option>")),1==$(".mcetoken-template option",a).length?($(".mcetoken-templatecontainer",a).show(),d(!1)):d()):($(".mcetoken-truncationlengthcontainer",a).hide(),$('.mcetoken-template option[value="after-truncation-template"]',a).remove(),0==$(".mcetoken-template option",a).length?$(".mcetoken-templatecontainer",a).hide():
d());g();q()}function q(){var a=y.items().toArray()[0],b=0,c=0;$("table.mcetelligent-form, div.mcetoken-templatecontainer",$(y.getEl())).each(function(){var a=$(this);a.is(":visible")&&(b<a.width()&&(b=a.width()),c+=a.height())});b+=40;c+=120;a.reflow();y.resizeTo(b,c)}var x,A=this,y,w="Insert token",z=A.isToken(A.editor.selection.getStart());z||(z=A.isToken(A.editor.selection.getEnd()));z&&(x=A.editor.dom.getAttrib(z,"data-mce-json"))&&(x=s.parse(x),w="Edit token");x||(x={id:"mceToken"+(new Date).getTime(),
tokenId:"",configuration:""});var v="editor"+(new Date).getTime(),r={},t=null,G=A.editor.settings.tokenDataTypeIds||[],C=null,D=null,E=null;y=A.editor.windowManager.open({title:tinymce.util.I18n.translate(w),body:[{type:"container",html:'<table role="presentation" border="0" cellpadding="4" cellspacing="0" class="mcetelligent-form"><tr>         <td><label for="token">'+tinymce.util.I18n.translate("Show")+'</label></td>          <td>            <select id="token" class="mce-textbox mcetoken-token" name="type">            </select>          </td>        </tr>                   <tr class="mcetoken-linkurltargetcontainer" style="display: none;">                      <td><label for="linkurltarget">'+
tinymce.util.I18n.translate("Open in")+'</label></td>                      <td>                          <select class="mce-textbox mcetoken-linkurltarget" id="linkurltarget" name="linkurltarget">                              <option value="">'+tinymce.util.I18n.translate("The current window")+'</option>                              <option value="_blank">'+tinymce.util.I18n.translate("A new window")+'</option>                          </select>                      </td>                  </tr>                  <tr id="imageurlsizecontainer" class="mcetoken-imageurlsizecontainer" style="display: none;">                      <td><label for="imageurlwidth">'+
tinymce.util.I18n.translate("With size")+'</label></td>                      <td>                          <input id="imageurlwidth" class="mce-textbox mcetoken-imageurlwidth" name="imageurlwidth" type="text" value="" columns="4" style="width: 5em;" />'+tinymce.util.I18n.translate("x")+'                          <input id="imageurlheight" class="mce-textbox mcetoken-imageurlheight" name="imageurlheight" type="text" value="" columns="4" style="width: 5em;" />                      </td>                  </tr>                  <tr id="truncationcontainer" class="mcetoken-truncationcontainer" style="display: none;">                      <td><label for="truncate">'+
tinymce.util.I18n.translate("With")+'</label></td>                      <td>                          <select id="truncate" class="mce-textbox mcetoken-truncate" name="type">                              <option value="">'+tinymce.util.I18n.translate("Unlimited length")+'</option>                              <option value="maxlength">'+tinymce.util.I18n.translate("Length limited to:")+'</option>            </select>                          <span id="truncationlengthcontainer" class="mcetoken-truncationlengthcontainer" style="display: none;">                              <input id="truncateat" class="mcetoken-truncateat mce-textbox" name="truncateat" type="text" value="" columns="4" style="width: 5em;" />                              <label for="truncateat">'+
tinymce.util.I18n.translate("characters")+'</label>                          </span>                      </td>                  </tr>        <tr id="conditioncontainer" class="mcetoken-conditioncontainer" style="display: none;">          <td><label for="condition">'+tinymce.util.I18n.translate("Varied")+'</label></td>          <td>                          <select id="condition" class="mce-textbox mcetoken-condition" name="type">                              <option value="">'+tinymce.util.I18n.translate("By nothing (render value directly)")+
'</option>                              <option value="e">'+tinymce.util.I18n.translate("When equal to")+'</option>                              <option value="lt">'+tinymce.util.I18n.translate("When less than")+'</option>                              <option value="lte">'+tinymce.util.I18n.translate("When less than or equal to")+'</option>                              <option value="gt">'+tinymce.util.I18n.translate("When greater than")+'</option>                              <option value="gte">'+
tinymce.util.I18n.translate("When greater than or equal to")+'</option>            </select>                          <select id="conditiontemplate" class="mce-textbox mcetoken-conditiontemplate">                              <option value="simple">'+tinymce.util.I18n.translate("value:")+'</option>                              <option value="template">'+tinymce.util.I18n.translate("condition template")+'</option>                          </select>                          <input id="conditionvalue" class="mce-textbox mcetoken-conditionvalue" name="conditionvalue" type="text" value="" style="width: 8em;" />          </td>        </tr>                  <tr id="maxcountcontainer" class="mcetoken-maxcountcontainer" style="display: none;">                      <td><label for="maxcount">'+
tinymce.util.I18n.translate("Limited to")+'</label></td>                      <td>                          <input id="maxcount" class="mce-textbox mcetoken-maxcount" name="maxcount" type="text" value="" style="width: 5em;" />                          '+tinymce.util.I18n.translate("items")+'                      </td>                  </tr>                <tr class="mcetoken-templatecontainer">                  <td><label for="template">'+tinymce.util.I18n.translate("Template")+'</label></td>                  <td>                        <select id="template" class="mce-textbox mcetoken-template" name="template">                        </select>                  </td>                </tr></table><div class="mcetoken-templatecontainer" style="width:600px; height:500px;"> <textarea id="'+
v+'"></textarea></div>'}],buttons:[{text:"Ok",onclick:function(){x.id&&(g(),b(!1,void 0),A.editor.execCommand("mceRepaint"),z&&A.editor.selection.select(z),A.editor.selection.setNode(A.dataToNode(x)),A.editor.nodeChanged(),y.close())},subtype:"primary"},{text:"Cancel",onclick:function(){y.close()}}]});window.setTimeout(function(){a()},10)};a.dataToNode=function(a,c){var b=this.editor,g;g=this.editor.dom.create("span",{id:a.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":s.serialize(a,
"'"),contenteditable:"false"},tinymce.util.I18n.translate("???"));this.getPreview(a,function(c,f){var h=b.dom.get(a.id);if(h)if(f){var d=b.dom.create("div",{id:a.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":s.serialize(a,"'"),contenteditable:"false"},c);h.parentNode.replaceChild(d,h)}else h.innerHTML=c});return g};a.dataToHtml=function(a,c){return this.editor.serializer.serialize(this.dataToNode(a,c),{forced_root_block:"",force_absolute:c})};a.htmlToData=function(a){var c,b;b=
{};a=this.editor.parser.parse(a);(c=a.getAll("span")[0])?b=s.parse(c.attr("data-mce-json")):(c=a.getAll("div")[0])&&(b=s.parse(c.attr("data-mce-json")));return b};a.nodeToObject=function(a,c){var b,g;if(b=a.attr("data-mce-json"))b=s.parse(b),b.tokenId&&(g=new q("#text",3),g.raw=!0,g.value="${token:"+b.tokenId,b.configuration&&(g.value+=":"+b.configuration),g.value+="}"),g?a.replace(g):a.remove()};a.resolveWhitespace=function(a){if(!a)return a;" "==a.substr(0,1)&&(a="&nbsp;"+a.substr(1));" "==a.substr(a.length-
1)&&(a=a.substr(0,a.length-1)+"&nbsp;");return a};a.textToObject=function(a){var c=this,b=c.editor;if(a.parent){for(var m=new q("div"),n=/\$\{token:([0-9a-f]{8,8}-[0-9a-f]{4,4}-[0-9a-f]{4,4}-[0-9a-f]{4,4}-[0-9a-f]{12,12})(?::([^}]*))?\}/gi,l,h=0;l=n.exec(a.value);)(function(){var d={id:"mceToken"+(new Date).getTime()+("v"+g++),tokenId:RegExp.$1,configuration:RegExp.$2?RegExp.$2:""};if(0<l.index)for(var n=b.parser.parse(c.resolveWhitespace(a.value.substr(h,l.index-h))),n=n.getAll("p"),p=0;p<n.length;p++)for(var t;null!=
(t=n[p].walk());)m.append(t);p=new q("span",1);m.append(p);p.attr({id:d.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":s.serialize(d,"'"),contenteditable:"false"});n=new q("#text",3);n.raw=!0;n.value=tinymce.util.I18n.translate("???");p.append(n);(function(a){c.getPreview(a,function(c,f){var h=b.dom.get(a.id);if(h){if(f){var g=b.dom.create("div",{id:d.id,"class":"mceItem mceTokenItem mceNonEditable","data-mce-json":s.serialize(d,"'"),contenteditable:"false"},c);h.parentNode.replaceChild(g,
h)}else h.innerHTML=c;b.undoManager.clear();b.undoManager.add()}})})(d)})(),h=n.lastIndex;if(0<h){if(h<a.value.length)for(var n=b.parser.parse(c.resolveWhitespace(a.value.substr(h))).getAll("p"),d=0;d<n.length;d++)for(var p;null!=(p=n[d].walk());)m.append(p);a.replace(m);m.unwrap()}}};a.cancelEvent=function(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();return!1};a.getCallbackUrl=function(c){for(var f=a.url+"../../../apis/tokens?",b={},g=tinyMCE_TelligentEvolutionOptions.ContextQueryString.split(/&/g),
n=0;n<g.length;n++){var l=g[n].split(/=/);2==l.length&&(b[l[0]]=l[1])}for(var h in c)b[encodeURIComponent(h)]=encodeURIComponent(c[h]);c=!0;for(h in b)c?c=!1:f+="&",f+=h+"="+b[h];return f};a.getTokens=function(c){var f=[];tinymce.util.XHR.send({url:a.getCallbackUrl({t:"lt"}),data:"dataTypeIds="+(c||[]).join(","),content_type:"application/x-www-form-urlencoded",async:!1,success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.tokens&&(f=a.tokens)}catch(c){}},error:function(a){alert(tinymce.util.I18n.translate("An error occurred while retrieving tokens."))}});
return f};a.getPreview=function(c,f){var b="${token:"+c.tokenId;c.configuration&&(b+=":"+c.configuration);b+="}";tinymce.util.XHR.send({url:a.getCallbackUrl({t:"pt"}),data:"token="+encodeURIComponent(b),content_type:"application/x-www-form-urlencoded",success:function(a){a=tinymce.util.JSON.parse(a);try{a&&a.preview?f(a.preview,"true"==a.block):f("???",!1)}catch(b){f("???",!1)}},error:function(a){f("???",!1)}})};c.on("PreInit",function(){c.parser.addNodeFilter("#text",function(c){for(var f=c.length;f--;)a.textToObject(c[f])});
c.serializer.addNodeFilter("div",function(c,f,b){f=c.length;for(var g;f--;)g=c[f],-1!==(g.attr("class")||"").indexOf("mceTokenItem")&&a.nodeToObject(g,b)});c.serializer.addNodeFilter("span",function(c,f,b){f=c.length;for(var g;f--;)g=c[f],-1!==(g.attr("class")||"").indexOf("mceTokenItem")&&a.nodeToObject(g,b)});c.on("dblclick",function(g){(g=a.isToken(c.selection.getStart()))||(g=a.isToken(c.selection.getEnd()));if(!1!==g)return a.openDialog(),!1})});c.addCommand("mceToken",function(){a.openDialog()});
c.addCommand("mceTokenRemove",function(){var g;g=c.selection.getNode();(g=a.isToken(g))&&c.dom.remove(g,!1)});c.on("ResolveName",function(c){!1!==a.isToken(c.target)&&(c.name=tinymce.util.I18n.translate("token"))});c.addMenuItem("removetoken",{text:"Remove token",cmd:"mceTokenRemove",stateSelector:"span.mceToken",context:"edit",prependToContext:!0,onPostRender:function(g){g.control.hide();c.on("NodeChange",function(){var f=c.selection.getNode();!1!==a.isToken(f)?g.control.show():g.control.hide()},
!0)}});c.addMenuItem("edittoken",{text:"Edit token",icon:"code",cmd:"mceToken",context:"edit",prependToContext:!0,onPostRender:function(g){g.control.hide();c.on("NodeChange",function(){var f=c.selection.getNode();!1!==a.isToken(f)?g.control.show():g.control.hide()},!0)}});c.addMenuItem("token",{text:"Insert token",icon:"code",cmd:"mceToken",context:"insert",prependToContext:!0});c.addButton("edittoken",{text:"Edit",cmd:"mceToken"});c.addButton("removetoken",{text:"Remove",onclick:function(){c.dom.remove(c.selection.getNode())}});
c.addContextToolbar(function(c){return a.isToken(c)},"edittoken removetoken")})})();
